<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1"name=viewport><meta content="dark light"name=color-scheme><meta content=#ffffff name=theme-color media=(prefers-color-scheme:light)><meta content=#000000 name=theme-color media=(prefers-color-scheme:dark)><meta content="Sabrina Jewson"property=og:site_name><link href=/favicon.ico rel=icon><link href=/apple-touch-icon.png rel=apple-touch-icon><link href=/common.css rel=stylesheet><title>Modular Errors in Rust - Sabrina Jewson</title><meta content="Modular Errors in Rust"property=og:title><meta content="It is thankfully common wisdom nowadays that documentation must be placed as near as possible to the code it documents, and should be fine-grained to a minimal unit of describability (the thing being documented). The practice provides numerous benefits to the codebase and project as a whole:"name=description><meta content=article property=og:type><link href=post.css rel=stylesheet><link href=feed.xml rel=alternate title="Sabrina Jewson's Blog"type=application/atom+xml></head><body><header><a href=/ class=name>Sabrina Jewson</a><nav><a href=/reviews>Reviews</a> <a href=/blog/ >Blog</a></nav></header><main><h1>Modular Errors in Rust</h1><p id=published><time datetime=2023-04-08>2023-04-08</time></p><nav><ul><li><a href=#blocks-txt>Case Study: A Blocks.txt Parser</a><ul><li><a href=#problem-1-backtraces>Problem 1: Backtraces</a></li><li><a href=#problem-2-inextensibility>Problem 2: Inextensibility</a></li><li><a href=#problem-3-error-matching>Problem 3: Error Matching</a></li><li><a href=#problem-4-privacy-and-stability>Problem 4: Privacy and Stability</a></li><li><a href=#problem-5-non-modularity>Problem 5: Non-Modularity</a></li></ul></li><li><a href=#guidelines-for-good-errors>Guidelines for Good Errors</a><ul><li><a href=#leveraging-source>Leveraging the <code class=scode>.source()</code> method</a></li><li><a href=#constructing-the-error-types>Constructing the error types</a></li><li><a href=#on-from>On <code class=scode>From</code></a></li><li><a href=#on-nearness>On “nearness”</a></li><li><a href=#verbosity>Verbosity</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav><p>It is thankfully common wisdom nowadays that documentation must be placed as near as possible to the code it documents, and should be fine-grained to a minimal unit of describability (the thing being documented). The practice provides numerous benefits to the codebase and project as a whole:</p><ol><li>When editing the source code, contributors are less likely to forget to update the documentation as well, ensuring it is kept up-to-date and accurate.</li><li>When reading the source code, reviewers can easily jump back and forth between the docs and the code it documents, helping them understand it and allowing them to contrast the expected with actual behaviour.</li><li>The codebase becomes more modular. Individual parts can be extracted into different crates or projects if necessary, and strong abstraction boundaries make the code easier to understand in small pieces.</li></ol><p>But you probably already knew this; after all, Rust made the excellent design choice of making it the by far easiest method of writing documentation at all. And you probably also know that these same principles apply to tests: when unit tests are kept next to their minimum unit of checkability, you get the same benefits of convenient updating, assisted understanding and modularity. And most Rust projects do use unit tests in this way (when they can, for often there are limitations that prevent it from working), which again we can thank the tooling for.</p><p>But that’s all old news. What I’m here to convince you of today is that this principle applies additionally to <em>error types</em>: that is, error types should be located near to their unit of fallibility. To illustrate this point, I will follow the initial development and later API improvement of a hypothetical Rust library.</p><h2 id=blocks-txt><a href=#blocks-txt class=anchor></a>Case Study: A Blocks.txt Parser</h2><p>Suppose you’re a library author, and you’re working on a crate to implement the parsing of <a href=https://www.unicode.org/Public/UCD/latest/ucd/Blocks.txt>Blocks.txt</a> in the <a href=https://unicode.org/ucd/ >Unicode Character Database</a>. If you’re not familiar with this file, it defines the list of so-called <a href=https://en.wikipedia.org/wiki/Unicode_block>Unicode blocks</a>, which are non-overlapping contiguous categories that Unicode characters can be sorted into. It looks a bit like this:</p><pre class=scode><code>0000..007F; Basic Latin
0080..00FF; Latin-1 Supplement
0100..017F; Latin Extended-A
0180..024F; Latin Extended-B
0250..02AF; IPA Extensions
</code></pre><p>This file tells you that, for example, the character “½”, <code class=scode>U+00BD</code>, is in the block “Latin-1 Supplement” because <code class=scode>0x0080 ≤ 0x00BD ≤ 0x00FF</code>. Every character has an associated block; characters which have not yet been assigned a block in the file above are considered to be in the special pseudo-block <code class=scode>No_Block</code>.</p><p>So let’s get started on a Rust parser. The specification for the format is given by <a href=https://www.unicode.org/reports/tr44/#Format_Conventions>section 4.2 of Unicode Annex #44</a>, but the format is so trivial you could almost guess it. Upon seeing this task, a typical Rustacean may write code like this:</p><pre class=scode><code><span class="srust ssource"><span class="srust scomment sline sdocumentation"><span class="srust spunctuation sdefinition scomment">//!</span> This crate provides tools for working with Unicode blocks and its data files.
</span>
<span class="srust smeta sstruct"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype sstruct">struct</span> </span><span class="srust smeta sstruct"><span class="srust sentity sname sstruct">Blocks</span> </span><span class="srust smeta sstruct"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust svariable smember sother">ranges</span><span class="srust spunctuation sseparator">:</span> <span class="srust smeta sgeneric">Vec<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sgeneric">RangeInclusive<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">u32</span><span class="srust spunctuation send sdefinition sgeneric">></span></span>, String<span class="srust spunctuation ssection sgroup send">)</span><span class="srust spunctuation send sdefinition sgeneric">></span></span>,
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl"><span class="srust simpl sentity sname">Blocks</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sstorage smodifier">pub</span> <span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">from_file</span></span><span class="srust smeta sgeneric"><span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>P<span class="srust spunctuation sseparator">:</span> <span class="srust smeta sgeneric">AsRef<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>Path<span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">path</span><span class="srust spunctuation sseparator">:</span> P</span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">Self</span>, Error<span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>from_str<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust skeyword soperator">&</span><span class="srust smeta spath">fs<span class="srust spunctuation saccessor">::</span></span>read_to_string<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>path</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sstorage smodifier">pub</span> <span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">download</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">agent</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust smeta spath">ureq<span class="srust spunctuation saccessor">::</span></span>Agent</span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">Self</span>, Error<span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust sstorage stype">let</span> response <span class="srust skeyword soperator">=</span> agent.<span class="srust sfunction ssupport">get</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sother sconstant">LATEST_URL</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">call</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
		<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>from_str<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust skeyword soperator">&</span>response.<span class="srust sfunction ssupport">into_string</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">FromStr <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">Blocks</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust sstorage stype stype">type</span> <span class="srust sentity sname stype">Err</span> <span class="srust skeyword soperator">=</span> Error<span class="srust spunctuation sterminator">;</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">from_str</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">s</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage stype">str</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">Self</span>, <span class="srust smeta spath"><span class="srust sstorage stype"><span class="srust sstorage stype">Self</span><span class="srust spunctuation saccessor">::</span></span></span>Err<span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust sstorage stype">let</span> ranges <span class="srust skeyword soperator">=</span> s
			.<span class="srust sfunction ssupport">lines</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			.<span class="srust sfunction ssupport">map</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust svariable sparameter">line</span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure">line.<span class="srust sfunction ssupport">split_once</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted ssingle"><span class="srust spunctuation sbegin sdefinition sstring">'</span>#<span class="srust spunctuation send sdefinition sstring">'</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">map</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust svariable sparameter">l</span><span class="srust spunctuation sseparator">,</span> _</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure">l</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">unwrap_or</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>line</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			.<span class="srust sfunction ssupport">filter</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust svariable sparameter">line</span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust skeyword soperator">!</span>line.<span class="srust sfunction ssupport">is_empty</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			.<span class="srust sfunction ssupport">map</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust svariable sparameter">line</span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
				<span class="srust sstorage stype">let</span> <span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>range<span class="srust spunctuation sseparator">,</span> name</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=</span> line.<span class="srust sfunction ssupport">split_once</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted ssingle"><span class="srust spunctuation sbegin sdefinition sstring">'</span>;<span class="srust spunctuation send sdefinition sstring">'</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">ok_or</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">Error<span class="srust spunctuation saccessor">::</span></span>NoSemicolon</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
				<span class="srust sstorage stype">let</span> <span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>range<span class="srust spunctuation sseparator">,</span> name</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=</span> <span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>range.<span class="srust sfunction ssupport">trim</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span> name.<span class="srust sfunction ssupport">trim</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sterminator">;</span>
				<span class="srust sstorage stype">let</span> <span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>start<span class="srust spunctuation sseparator">,</span> end</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=</span> range.<span class="srust sfunction ssupport">split_once</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>..<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">ok_or</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">Error<span class="srust spunctuation saccessor">::</span></span>NoDotDot</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
				<span class="srust sstorage stype">let</span> start <span class="srust skeyword soperator">=</span> <span class="srust sstorage stype">u32</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>from_str_radix<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>start<span class="srust spunctuation sseparator">,</span> <span class="srust sconstant sdecimal sinteger snumeric">16</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
				<span class="srust sstorage stype">let</span> end <span class="srust skeyword soperator">=</span> <span class="srust sstorage stype">u32</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>from_str_radix<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>end<span class="srust spunctuation sseparator">,</span> <span class="srust sconstant sdecimal sinteger snumeric">16</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
				<span class="srust ssupport stype">Ok</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>start<span class="srust skeyword soperator">..</span><span class="srust skeyword soperator">=</span>end<span class="srust spunctuation sseparator">,</span> name.<span class="srust sfunction ssupport">to_owned</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			.<span class="srust smeta spath">collect<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta sgeneric"><span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust smeta sgeneric">Vec<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust skeyword soperator">_</span><span class="srust spunctuation send sdefinition sgeneric">></span></span>, Error<span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
		<span class="srust ssupport stype">Ok</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstorage stype">Self</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> ranges </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span></code></pre><p>Now we need to define an error type, so let’s just follow the “big <code class=scode><span class="srust ssource"><span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span> <span class="srust sstorage stype senum">enum</span></span></code>” convention and bash out some boilerplate that gets the job done:</p><pre class=scode><code><span class="srust ssource"><span class="srust scomment sline sdocumentation"><span class="srust spunctuation sdefinition scomment">///</span> An error in this library.
</span><span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta senum"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype senum">enum</span> <span class="srust sentity sname senum">Error</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	NoSemicolon<span class="srust spunctuation sseparator">,</span>
	NoDotDot<span class="srust spunctuation sseparator">,</span>
	ParseInt<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>ParseIntError</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
	Io<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">io<span class="srust spunctuation saccessor">::</span></span>Error</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
	Ureq<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sgeneric">Box<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust smeta spath">ureq<span class="srust spunctuation saccessor">::</span></span>Error<span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl"><span class="srust smeta sgeneric">From<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>ParseIntError<span class="srust spunctuation send sdefinition sgeneric">></span></span> <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">Error</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">from</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">error</span><span class="srust spunctuation sseparator">:</span> ParseIntError</span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust sstorage stype">Self</span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>ParseInt<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>error</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl"><span class="srust smeta sgeneric">From<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust smeta spath">io<span class="srust spunctuation saccessor">::</span></span>Error<span class="srust spunctuation send sdefinition sgeneric">></span></span> <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">Error</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">from</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">error</span><span class="srust spunctuation sseparator">:</span> <span class="srust smeta spath">io<span class="srust spunctuation saccessor">::</span></span>Error</span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust sstorage stype">Self</span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>Io<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>error</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl"><span class="srust smeta sgeneric">From<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust smeta spath">ureq<span class="srust spunctuation saccessor">::</span></span>Error<span class="srust spunctuation send sdefinition sgeneric">></span></span> <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">Error</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">from</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">error</span><span class="srust spunctuation sseparator">:</span> <span class="srust smeta spath">ureq<span class="srust spunctuation saccessor">::</span></span>Error</span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust sstorage stype">Self</span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>Ureq<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust ssupport stype">Box</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>new<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>error</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Display <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">Error</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">fmt</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span>, <span class="srust svariable sparameter">f</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage smodifier">mut</span> <span class="srust smeta sgeneric">Formatter<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>'<span class="srust skeyword soperator">_</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Result</span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust skeyword scontrol">match</span> <span class="srust svariable slanguage">self</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>NoSemicolon <span class="srust skeyword soperator">=></span> f.<span class="srust sfunction ssupport">write_str</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>no semicolon<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>NoDotDot <span class="srust skeyword soperator">=></span> f.<span class="srust sfunction ssupport">write_str</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>no `..` in character range<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>ParseInt<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust smeta spath">Display<span class="srust spunctuation saccessor">::</span></span>fmt<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e<span class="srust spunctuation sseparator">,</span> f</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>Io<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust smeta spath">Display<span class="srust spunctuation saccessor">::</span></span>fmt<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e<span class="srust spunctuation sseparator">,</span> f</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>Ureq<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust smeta spath">Display<span class="srust spunctuation saccessor">::</span></span>fmt<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e<span class="srust spunctuation sseparator">,</span> f</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
		</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl"><span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">error<span class="srust spunctuation saccessor">::</span></span>Error <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">Error</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span></span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span></code></pre><p>Lastly, a couple other bits and imports go at the end:</p><pre class=scode><code><span class="srust ssource"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype">const</span> <span class="srust sother sconstant">LATEST_URL</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage stype">str</span> <span class="srust skeyword soperator">=</span> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>https://www.unicode.org/Public/UCD/latest/ucd/Blocks.txt<span class="srust spunctuation send sdefinition sstring">"</span></span><span class="srust spunctuation sterminator">;</span>

<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span>cmp<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span>fmt<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Display<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Formatter<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span>fs<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span>io<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">num<span class="srust spunctuation saccessor">::</span></span>ParseIntError<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">ops<span class="srust spunctuation saccessor">::</span></span>RangeInclusive<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">path<span class="srust spunctuation saccessor">::</span></span>Path<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">str<span class="srust spunctuation saccessor">::</span></span>FromStr<span class="srust spunctuation sterminator">;</span>
</span></code></pre><p>And we’re done.</p><p>There are a few small things to note with this code just before we move on:</p><ol><li>I omitted documentation, since it’s not relevant to the real example; in actual code, all the public items would be documented. Similarly, unit tests are omitted.</li><li>In a real library, one would not hard-depend on <a href=https://docs.rs/ureq>ureq</a> and <code class=scode>std</code> and would use feature-flags instead, but again I omitted that for this example.</li><li>You might have noticed I put my imports on separate lines each at bottom — I do have my reasons for this, but that’s best saved for another day ;)</li><li><code class=scode>Blocks</code> implements <a href=https://doc.rust-lang.org/stable/std/str/trait.FromStr.html><code class=scode>FromStr</code></a>, but not <a href=https://doc.rust-lang.org/stable/std/convert/trait.TryFrom.html><code class=scode><span class="srust ssource"><span class="srust smeta sgeneric">TryFrom<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust skeyword soperator">&</span><span class="srust sstorage stype">str</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span></code></a>. This is actually intentional, because despite being nearly identical traits signature-wise they mean two very different things: <code class=scode>FromStr</code> implies <em>parsing</em> from a string whereas <code class=scode><span class="srust ssource"><span class="srust smeta sgeneric">TryFrom<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust skeyword soperator">&</span><span class="srust sstorage stype">str</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span></code> is for when your data type <em>is</em> a subset of all strings. In our case, <code class=scode>FromStr</code> is the correct one to use.</li><li>The <code class=scode>Display</code> implementation of <code class=scode>Error</code> formats error messages like <code class=scode>no semicolon</code> in lowercase and without a full stop at the end — this is in accordance with <a href=https://doc.rust-lang.org/stable/std/error/trait.Error.html>conventions established by the Standard Library</a> (“Error messages are typically concise lowercase sentences without trailing punctuation”). A common pitfall of both new and experienced Rustaceans is using incorrect casing for error messages.</li><li>Another common pitfall is naming things like what we’ve named <code class=scode>Error::Io</code> as <code class=scode>Error::IoError</code> instead. Simply: you don’t need the <code class=scode>Error</code> suffix, it says it in the name already!</li><li>One could use the <a href=https://docs.rs/thiserror/latest/thiserror/ >thiserror</a> crate to shorten the code by using a <code class=scode><span class="srust ssource"><span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Error</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span></span></code>. Personally, I would never use this for a library crate since it’s really not that many lines of code saved for a whole extra dependency, but you might want to know about it.</li><li>The <code class=scode>Ureq</code> variant of the <code class=scode>Error</code> enum is boxed because <code class=scode>ureq::Error</code> is actually very large and Clippy complains about it.</li></ol><p>So there we have it: our perfect little library, let’s go off and publish it to crates.io.</p><p>What we’ve written so far, with regard to error handling, is what I’d say most libraries on crates.io do. It’s by far the most <em>common</em> way of handling errors: just stick everything in a big <code class=scode><span class="srust ssource"><span class="srust sstorage stype senum">enum</span></span></code> of “different ways things can go wrong in the library” and don’t think about it after that. But unfortunately, while it is <em>common</em> it is not exactly <em>good</em>, for a few reasons the rest of this post will be covering.</p><h3 id=problem-1-backtraces><a href=#problem-1-backtraces class=anchor></a>Problem 1: Backtraces</h3><p>Suppose you then decide to use your library in a CLI application; and as per usual advice and your own experience, you decide to use <a href=https://docs.rs/anyhow>anyhow</a> to handle the errors in it. So you write out all your code and it looks a little like this:</p><pre class=scode><code><span class="srust ssource"><span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">main</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta spath">anyhow<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust spunctuation ssection sgroup send">)</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust sfunction ssupport">init_something</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
	<span class="srust sstorage stype">let</span> blocks <span class="srust skeyword soperator">=</span> <span class="srust smeta spath">Blocks<span class="srust spunctuation saccessor">::</span></span>from_file<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>Blocks.txt<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
	<span class="srust sfunction ssupport">init_something_else</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
	<span class="srust scomment sline sdouble-slash"><span class="srust spunctuation sdefinition scomment">//</span> Run the main code…
</span>	<span class="srust ssupport stype">Ok</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust skeyword sother">use</span> <span class="srust smeta spath">unicode_blocks<span class="srust spunctuation saccessor">::</span></span>Blocks<span class="srust spunctuation sterminator">;</span>
</span></code></pre><p>Looks good, so you go ahead and run it — only, you’re rather abruptly met with:</p><pre class=scode><code>Error: invalid digit found in string
</code></pre><p>Um, okay. That doesn’t help us very much at all. What went wrong here?</p><p>Well, much pain and many <code class=scode>dbg!</code> statements later, you discover that the culprit is that somehow, on line 223 of <code class=scode>Blocks.txt</code> you replaced a <code class=scode>0</code> with an <code class=scode>O</code>. Oops!</p><pre class=scode><code><span class="ssource sdiff"><span class="smeta sdiff sheader sfrom-file"><span class="spunctuation sdefinition sdiff sfrom-file">---</span> Blocks.txt
</span><span class="smeta sdiff sheader sto-file"><span class="spunctuation sdefinition sdiff sto-file">+++</span> Blocks.txt
</span><span class="smeta sdiff srange sunified"><span class="spunctuation sdefinition sdiff srange">@@</span> <span class="smeta sdiff sline-number stoc-list">-222,3 +222,3</span> <span class="spunctuation sdefinition sdiff srange">@@</span>
</span> 10800..1083F; Cypriot Syllabary
<span class="sdiff sdeleted smarkup"><span class="spunctuation sdefinition sdiff sdeleted">-</span>10840..1O85F; Imperial Aramaic
</span><span class="sdiff sinserted smarkup"><span class="spunctuation sdefinition sdiff sinserted">+</span>10840..1085F; Imperial Aramaic
</span> 10860..1087F; Palmyrene
</span></code></pre><p>And then you run it again and it works fine.</p><p>But it didn’t have to be this hard. The error message <em>could</em> have displayed something more useful, and maybe this is just a pipe dream, but I’ve seen <code class=scode>anyhow</code> emit this sort of thing before:</p><pre class=scode><code>Error: error reading `Blocks.txt`

Caused by:
	0: invalid Blocks.txt data on line 223
	1: one end of range is not a valid hexidecimal integer
	2: invalid digit found in string
</code></pre><p>That’s so much more helpful — you wouldn’t ever have had to suspect <code class=scode>init_something</code> and <code class=scode>init_something_else</code> as potential causes of the error, or even search <code class=scode>Blocks.txt</code> for mistakes, it completely guides you to exactly where it went wrong!</p><p>Oh well, you say to yourself, at least this time it was decently obvious where the source of the error came from; at least I wasn’t getting a <a href=https://github.com/tokio-rs/mio/issues/1444>file not found error from <code class=scode>TcpListener::bind</code></a> (the natural conclusion to this kind of “flat”-style error handling). But wouldn’t it be nice if all errors came with backtrace and context tracking built-in?</p><h3 id=problem-2-inextensibility><a href=#problem-2-inextensibility class=anchor></a>Problem 2: Inextensibility</h3><p>At least one of the things in the above image looks feasible to fix though: adding line numbers as context to the error messages. All we have to do is return to our <code class=scode>Error</code> enum and add more fields to the <code class=scode>NoSemicolon</code>, and <code class=scode>NoDotDot</code>, and <code class=scode>ParseInt</code>, variants:</p><pre class=scode><code><span class="srust ssource"><span class="srust smeta senum"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype senum">enum</span> <span class="srust sentity sname senum">Error</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	NoSemicolon <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> line<span class="srust spunctuation sseparator">:</span> <span class="srust sstorage stype">usize</span> </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span><span class="srust spunctuation sseparator">,</span>
	NoDotDot <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> line<span class="srust spunctuation sseparator">:</span> <span class="srust sstorage stype">usize</span> </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span><span class="srust spunctuation sseparator">,</span>
	ParseInt <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> line<span class="srust spunctuation sseparator">:</span> <span class="srust sstorage stype">usize</span><span class="srust spunctuation sseparator">,</span> source<span class="srust spunctuation sseparator">:</span> ParseIntError </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span><span class="srust spunctuation sseparator">,</span>
	Io<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">io<span class="srust spunctuation saccessor">::</span></span>Error</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
	Ureq<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sgeneric">Box<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust smeta spath">ureq<span class="srust spunctuation saccessor">::</span></span>Error<span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span></code></pre><p>Except… we can’t do that without breaking backward compatibility, because while the enum itself is <code class=scode><span class="srust ssource"><span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span></span></code> the individual variants aren’t, meaning you’ve fixed them to forever have the fields they do currently (without breaking changes).</p><h3 id=problem-3-error-matching><a href=#problem-3-error-matching class=anchor></a>Problem 3: Error Matching</h3><p>Okay, so back to the application. You’ve now realized that you still want to call <code class=scode><span class="srust ssource"><span class="srust smeta spath">Blocks<span class="srust spunctuation saccessor">::</span></span>from_file<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>Blocks.txt<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span></code>, but if it fails with a “file not found” error you actually want to download the file automatically instead of exiting the program entirely. We have to match on the <code class=scode><span class="srust ssource"><span class="srust ssupport stype">Result</span></span></code> for that:</p><pre class=scode><code><span class="srust ssource"><span class="srust sstorage stype">let</span> blocks <span class="srust skeyword soperator">=</span> <span class="srust skeyword scontrol">match</span> <span class="srust smeta spath">Blocks<span class="srust spunctuation saccessor">::</span></span>from_file<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>Blocks.txt<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust ssupport stype">Ok</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>blocks</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> blocks<span class="srust spunctuation sseparator">,</span>
	<span class="srust ssupport stype">Err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">unicode_blocks<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">Error<span class="srust spunctuation saccessor">::</span></span>Io<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword scontrol">if</span> e.<span class="srust sfunction ssupport">kind</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=</span><span class="srust skeyword soperator">=</span> <span class="srust smeta spath">io<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">ErrorKind<span class="srust spunctuation saccessor">::</span></span>NotFound <span class="srust skeyword soperator">=></span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust scomment sline sdouble-slash"><span class="srust spunctuation sdefinition scomment">//</span> download and retry…
</span>	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span><span class="srust spunctuation sterminator">;</span>
</span></code></pre><p>Great! But the compiler is yelling that the <code class=scode><span class="srust ssource"><span class="srust skeyword scontrol">match</span></span></code> arms aren’t exhaustive. Not too hard to fix, let’s look at the cases we need to deal with:</p><ul><li><code class=scode>NoSemicolon</code>, <code class=scode>NoDotDot</code>, <code class=scode>ParseInt</code>: Those are pretty obvious, they look like parsing errors, so we can just propagate them.</li><li><code class=scode>Io</code>: Other I/O errors than “file not found” can also safely be propagated.</li><li><code class=scode>Ureq</code>: Ummm…? Wait, is this function doing HTTP requests? Let me check the source code again… [please stand by…] oh okay, so it’s not. Then I could add an <code class=scode><span class="srust ssource"><span class="srust ssupport smacro">unreachable!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span></code> here which would be correct and indicates semantics nicely; on the other hand, nowhere is it written in the documentation of the API that it <em>won’t</em> ever return this, so maybe I should just propagate it anyway?</li><li>Oh, and I forgot, we added <code class=scode>#[non_exhaustive]</code> to <code class=scode><span class="srust ssource"><span class="srust smeta senum"><span class="srust sstorage stype senum">enum</span> <span class="srust sentity sname senum">Error</span></span></span></code> so there’s always the possibility of it returning a variant that doesn’t exist yet. Well, I guess we can just propagate it anyway.</li></ul><p>So, this situation isn’t ideal. The library doesn’t document anywhere what errors a given function <em>can</em> return, so users are often left shooting in the dark. From personal experience, there have been many times I have seen an error variant which was appropriate for me to catch, then I had to spend ages digging around in the source code to find out whether it was <em>actually</em> generated or not — and even an answer to that doesn’t constitute an API guarantee that it will or won’t be in future.</p><p>Another issue with the code that we’ve written is that it’s entirely non-obvious that our <code class=scode><span class="srust ssource"><span class="srust skeyword scontrol">match</span></span></code> arm refers specifically to the <code class=scode>Blocks.txt</code> file not being found. The arm itself just says “check if an I/O not found error occurred”, but in theory, and especially for more complex functions, an I/O not found error could mean one of several different things that the user can no longer differentiate between because they were all put together in a single <code class=scode>Io</code> variant.</p><h3 id=problem-4-privacy-and-stability><a href=#problem-4-privacy-and-stability class=anchor></a>Problem 4: Privacy and Stability</h3><p>One very common mistake libraries make with this style of big-<code class=scode><span class="srust ssource"><span class="srust sstorage stype senum">enum</span></span></code> error is accidentally exposing dependencies intended to be private in their public API through error types. In our example code, suppose <code class=scode>std::fs</code> and <code class=scode>io::Error</code> weren’t part of the standard library but were rather types from an external library that was on version <code class=scode>0.4</code>. Now, when they bump their version to <code class=scode>0.5</code> I <em>also</em> have to make a breaking change to update it to the newer version, because I exposed the <code class=scode>io::Error</code> type in my public API through the <code class=scode>Error</code> enum, even though I never expose my usage of the library anywhere else (it’s covered up by the opaque interface of <code class=scode>from_file</code>). The same issue occurs if I tried to switch out my usage of that library for a different one; it also forbids me from ever releasing 1.0 until the dependency library also reaches 1.0 as per the <a href=https://rust-lang.github.io/api-guidelines/necessities.html#public-dependencies-of-a-stable-crate-are-stable-c-stable>C-STABLE</a> API requirement.</p><p>This is hard to fix with this approach to errors, because <code class=scode><span class="srust ssource"><span class="srust sstorage stype senum">enum</span></span></code> data is hardcoded to always use inherited visibility, meaning if the outer <code class=scode><span class="srust ssource"><span class="srust sstorage stype senum">enum</span></span></code> fields are public <em>all</em> inner fields are too. Private fields are also useful in errors in general, for reasons other than stability: private fields are just generally a nice feature to have on types.</p><h3 id=problem-5-non-modularity><a href=#problem-5-non-modularity class=anchor></a>Problem 5: Non-Modularity</h3><p>And lastly, touching back on what I mentioned at the beginning of this article: this approach to error handling is <em>non-modular</em>. I couldn’t easily take a component alone, like the parser, and extract it to a different crate, because I’d have to change many APIs or otherwise hack around it. Every API is interconnected with each other through the underlying error type, tying the crate together in a big knot that makes it difficult to untangle and remove stuff.</p><p>This kind of non-modularity also makes the codebase more difficult to understand: one is forced, to a greater degree, to learn the entire codebase at once to work on it, rather than learn it piece by piece, a far preferable way of learning.</p><h2 id=guidelines-for-good-errors><a href=#guidelines-for-good-errors class=anchor></a>Guidelines for Good Errors</h2><p>So the current error type we have has problems. But how do we fix them? And this is where we bring in that principle from the start:</p><blockquote><p>Error types should be located near to their unit of fallibility.</p></blockquote><p>The key phrase here is “unit of fallibility”. What are the units of fallibility in our library? Well, it’s certainly not <em>the library itself</em> — the library is just a way of interacting with Unicode blocks, and it’s not like that can particularly fail. The only libraries that <em>would</em> have the entire library as a unit of fallibility are those whose only purpose is to perform a single operation (they typically have an API surface of no more than two functions, maybe a <code class=scode>Params</code> builder type, and nothing more).</p><p>This tells us that the <code class=scode>unicode_blocks::Error</code> type is inherently misguided. Rather, the units of fallibility in our case are the <em>operations we do</em>, like downloading, reading a file, and parsing.</p><p>Now, things get a little subjective at this point on deciding what counts as two separate units or the same unit. In general, you should ask yourself the following two questions:</p><ol><li>Do they have different ways in which they can fail?</li><li>Should they show different error messages should they fail?</li></ol><p>If the answer to either of those questions is “yes”, then they should normally be separate error types.</p><p>For us, this means we actually want <em>three</em> separate error types:</p><ol><li><code class=scode>FromFileError</code>, for errors in <code class=scode>Blocks::from_file</code>;</li><li><code class=scode>DownloadError</code>, for errors in <code class=scode>Blocks::download</code>;</li><li><code class=scode>ParseError</code>, for errors in <code class=scode>from_str</code>.</li></ol><h3 id=leveraging-source><a href=#leveraging-source class=anchor></a>Leveraging the <code class=scode>.source()</code> method</h3><p>Earlier, we said we wanted our error messages (printed with <code class=scode>anyhow</code>) to look good, like this:</p><pre class=scode><code>Error: error reading `Blocks.txt`

Caused by:
	0: invalid Blocks.txt data on line 223
	1: one end of range is not a valid hexidecimal integer
	2: invalid digit found in string
</code></pre><p>So how do we get <code class=scode>anyhow</code> to print this? It turns out what the library calls internally is the <a href=https://doc.rust-lang.org/stable/std/error/trait.Error.html#method.source><code class=scode>Error::source()</code></a> method, a default-implemented method of the <code class=scode>Error</code> trait that tells you the cause of an error. What we see in the above graphic depicts:</p><ol><li>an error type (we know to be <code class=scode>FromFileError</code>) whose <code class=scode>Display</code> implementation prints “error reading <code class=scode>Blocks.txt</code>”, and whose <code class=scode>source</code> is…</li><li>…another error type, whose <code class=scode>Display</code> implementation prints “invalid Blocks.txt data on line 223”, and whose <code class=scode>source</code> is…</li><li>…another error type, whose <code class=scode>Display</code> implementation prints “one end of range is not a valid hexidecimal integer”, and whose <code class=scode>source</code> is…</li><li>…another error type (we know to be <code class=scode>ParseIntError</code>) whose <code class=scode>Display</code> implementation prints “invalid digit found in string” and whose <code class=scode>source</code> is <code class=scode>None</code>.</li></ol><p>That might seem like a lot of layers, but they all map very nicely to our code: layer 1 is a <code class=scode>FromFileError</code>, layer 2 has to be our <code class=scode>ParseError</code>, layer 3 has to be something contained within the <code class=scode>ParseError</code>, and layer 4 is <code class=scode>ParseIntError</code>.</p><p>This leads us to a much nicer structure for the error types in the <code class=scode>from_file</code> API.</p><pre class=scode><code><span class="srust ssource"><span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sstruct"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype sstruct">struct</span> </span><span class="srust smeta sstruct"><span class="srust sentity sname sstruct">FromFileError</span> </span><span class="srust smeta sstruct"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust sstorage smodifier">pub</span> <span class="srust svariable smember sother">path</span><span class="srust spunctuation sseparator">:</span> <span class="srust smeta sgeneric">Box<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>Path<span class="srust spunctuation send sdefinition sgeneric">></span></span>,
	<span class="srust sstorage smodifier">pub</span> <span class="srust svariable smember sother">kind</span><span class="srust spunctuation sseparator">:</span> FromFileErrorKind,
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Display <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">FromFileError</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">fmt</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span>, <span class="srust svariable sparameter">f</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage smodifier">mut</span> <span class="srust smeta sgeneric">Formatter<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>'<span class="srust skeyword soperator">_</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Result</span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust ssupport smacro">write!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup">f,</span><span class="srust smeta sgroup"> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>error reading `<span class="srust sother sconstant splaceholder">{}</span>`<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation sseparator">,</span> <span class="srust svariable slanguage">self</span>.path.<span class="srust sfunction ssupport">display</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Error <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">FromFileError</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">source</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Option<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust skeyword soperator">&</span><span class="srust spunctuation ssection sgroup sbegin">(</span>dyn Error + <span class="srust sstorage smodifier slifetime">'static</span><span class="srust spunctuation ssection sgroup send">)</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust skeyword scontrol">match</span> <span class="srust skeyword soperator">&</span><span class="srust svariable slanguage">self</span>.kind <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
			<span class="srust smeta spath">FromFileErrorKind<span class="srust spunctuation saccessor">::</span></span>ReadFile<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust smeta spath">FromFileErrorKind<span class="srust spunctuation saccessor">::</span></span>Parse<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
		</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta senum"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype senum">enum</span> <span class="srust sentity sname senum">FromFileErrorKind</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	ReadFile<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">io<span class="srust spunctuation saccessor">::</span></span>Error</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
	Parse<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>ParseError</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span></code></pre><p>This error:</p><ul><li>has very good backtraces, as it implements <code class=scode>Display</code> and <code class=scode>source()</code> well;</li><li>is extensible, as the <code class=scode><span class="srust ssource"><span class="srust sstorage stype sstruct">struct</span></span></code> is attributed with <code class=scode><span class="srust ssource"><span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span></span></code>;</li><li>supports precise error matching, as we’ve now <em>automatically</em> given the public API guarantee that we won’t produce HTTP errors from our function, so our users needn’t worry about dealing with that case;</li><li>makes it clear where the <code class=scode>io::Error</code>s can come from, because the variant is named <code class=scode>ReadFile</code> instead of simply <code class=scode>Io</code>;</li><li>would easily be able to adjust to support hiding <code class=scode>io::Error</code> from the public API surface simply by making <code class=scode>kind</code> and <code class=scode>FromFileErrorKind</code> private;</li><li>is entirely modular, being conceptually contained within the <code class=scode>from_file</code> logic portion of the code, so it can be extracted, learnt independently, et cetera.</li></ul><p><code class=scode>ParseError</code> can be defined in a somewhat similar fashion, also with the above benefits.</p><pre class=scode><code><span class="srust ssource"><span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sstruct"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype sstruct">struct</span> </span><span class="srust smeta sstruct"><span class="srust sentity sname sstruct">ParseError</span> </span><span class="srust smeta sstruct"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust sstorage smodifier">pub</span> <span class="srust svariable smember sother">line</span><span class="srust spunctuation sseparator">:</span> <span class="srust sstorage stype">usize</span>,
	<span class="srust sstorage smodifier">pub</span> <span class="srust svariable smember sother">kind</span><span class="srust spunctuation sseparator">:</span> ParseErrorKind,
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Display <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">ParseError</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">fmt</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span>, <span class="srust svariable sparameter">f</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage smodifier">mut</span> <span class="srust smeta sgeneric">Formatter<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>'<span class="srust skeyword soperator">_</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Result</span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust ssupport smacro">write!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup">f,</span><span class="srust smeta sgroup"> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>invalid Blocks.txt data on line <span class="srust sother sconstant splaceholder">{}</span><span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation sseparator">,</span> <span class="srust svariable slanguage">self</span>.line <span class="srust skeyword soperator">+</span> <span class="srust sconstant sdecimal sinteger snumeric">1</span><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Error <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">ParseError</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">source</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Option<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust skeyword soperator">&</span><span class="srust spunctuation ssection sgroup sbegin">(</span>dyn Error + <span class="srust sstorage smodifier slifetime">'static</span><span class="srust spunctuation ssection sgroup send">)</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable slanguage">self</span>.kind</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta senum"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype senum">enum</span> <span class="srust sentity sname senum">ParseErrorKind</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
	NoSemicolon<span class="srust spunctuation sseparator">,</span>
	<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
	NoDotDot<span class="srust spunctuation sseparator">,</span>
	<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
	ParseInt <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> source<span class="srust spunctuation sseparator">:</span> ParseIntError </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span><span class="srust spunctuation sseparator">,</span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Display <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">ParseErrorKind</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">fmt</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span>, <span class="srust svariable sparameter">f</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage smodifier">mut</span> <span class="srust smeta sgeneric">Formatter<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>'<span class="srust skeyword soperator">_</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Result</span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust skeyword scontrol">match</span> <span class="srust skeyword soperator">*</span><span class="srust svariable slanguage">self</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>NoSemicolon <span class="srust skeyword soperator">=></span> f.<span class="srust sfunction ssupport">write_str</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>no semicolon<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>NoDotDot <span class="srust skeyword soperator">=></span> f.<span class="srust sfunction ssupport">write_str</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>no `..` in range<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>ParseInt <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> <span class="srust skeyword soperator">..</span> </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span> <span class="srust skeyword soperator">=></span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
				f.<span class="srust sfunction ssupport">write_str</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>one end of range is not a valid hexadecimal integer<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
		</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Error <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">ParseErrorKind</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">source</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Option<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust skeyword soperator">&</span><span class="srust spunctuation ssection sgroup sbegin">(</span>dyn Error + <span class="srust sstorage smodifier slifetime">'static</span><span class="srust spunctuation ssection sgroup send">)</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust skeyword scontrol">match</span> <span class="srust svariable slanguage">self</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>ParseInt <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> source </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>source</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust skeyword soperator">_</span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">None</span><span class="srust spunctuation sseparator">,</span>
		</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span></code></pre><p>Note that the <code class=scode><span class="srust ssource"><span class="srust sstorage stype senum">enum</span></span></code> variants themselves are <code class=scode><span class="srust ssource"><span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span></span></code>, so that they can be extended in future with more information.</p><p>There is a slight deviation from <code class=scode>FromFileError</code>’s design here, that its corresponding <code class=scode>*Kind</code> type actually implements <code class=scode>Display</code> and <code class=scode>Error</code> in and of itself instead of simply existing as a data holder for other error types. The logic is that while we could separate make unit structs for <code class=scode>NoSemicolon</code>, <code class=scode>NoDotDot</code> and <code class=scode>ParseInt</code>, it just isn’t very necessary here (where on the other hand <code class=scode>io::Error</code> is an external type and <code class=scode>ParseError</code> is required to be a distinct type because of <code class=scode>FromStr</code>). However, sometimes it is still better to make unit structs: it depends on the use case.</p><p>Finally, <code class=scode>DownloadError</code> showcases a similar pattern (although it’s not that interesting at this point):</p><pre class=scode><code><span class="srust ssource"><span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sstruct"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype sstruct">struct</span> </span><span class="srust smeta sstruct"><span class="srust sentity sname sstruct">DownloadError</span> </span><span class="srust smeta sstruct"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust sstorage smodifier">pub</span> <span class="srust svariable smember sother">kind</span><span class="srust spunctuation sseparator">:</span> DownloadErrorKind,
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Display <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">DownloadError</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">fmt</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span>, <span class="srust svariable sparameter">f</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage smodifier">mut</span> <span class="srust smeta sgeneric">Formatter<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>'<span class="srust skeyword soperator">_</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Result</span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust ssupport smacro">write!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup">f,</span><span class="srust smeta sgroup"> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>failed to download Blocks.txt from the Unicode website<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Error <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">DownloadError</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">source</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Option<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust skeyword soperator">&</span><span class="srust spunctuation ssection sgroup sbegin">(</span>dyn Error + <span class="srust sstorage smodifier slifetime">'static</span><span class="srust spunctuation ssection sgroup send">)</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust skeyword scontrol">match</span> <span class="srust skeyword soperator">&</span><span class="srust svariable slanguage">self</span>.kind <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
			<span class="srust smeta spath">DownloadErrorKind<span class="srust spunctuation saccessor">::</span></span>Request<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust smeta spath">DownloadErrorKind<span class="srust spunctuation saccessor">::</span></span>ReadBody<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust smeta spath">DownloadErrorKind<span class="srust spunctuation saccessor">::</span></span>Parse<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
		</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta senum"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype senum">enum</span> <span class="srust sentity sname senum">DownloadErrorKind</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	Request<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sgeneric">Box<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust smeta spath">ureq<span class="srust spunctuation saccessor">::</span></span>Error<span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
	ReadBody<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">io<span class="srust spunctuation saccessor">::</span></span>Error</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
	Parse<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>ParseError</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span></code></pre><p>Note that we could have merged <code class=scode>DownloadErrorKind</code> and <code class=scode>DownloadError</code> into a single type; I chose not to here in favour of extensibility, because it seems quite possible that one would want to add more fields to <code class=scode>DownloadError</code> in future. But for some cases it definitely makes sense.</p><h3 id=constructing-the-error-types><a href=#constructing-the-error-types class=anchor></a>Constructing the error types</h3><p>If you try to implement the functions that return these error types, you’ll quickly run into something rather annoying: they require quite a bit of boilerplate to use. For example, the body of <code class=scode>from_file</code> now looks like this:</p><pre class=scode><code><span class="srust ssource"><span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sstorage smodifier">pub</span> <span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">from_file</span></span><span class="srust smeta sgeneric"><span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>P<span class="srust spunctuation sseparator">:</span> <span class="srust smeta sgeneric">AsRef<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>Path<span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">path</span><span class="srust spunctuation sseparator">:</span> P</span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">Self</span>, FromFileError<span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust sstorage stype">let</span> path <span class="srust skeyword soperator">=</span> path.<span class="srust sfunction ssupport">as_ref</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sterminator">;</span>
	<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust sstorage stype">let</span> s <span class="srust skeyword soperator">=</span> <span class="srust smeta spath">fs<span class="srust spunctuation saccessor">::</span></span>read_to_string<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>path</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">FromFileErrorKind<span class="srust spunctuation saccessor">::</span></span>ReadFile</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
		<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>from_str<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust skeyword soperator">&</span>s</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">FromFileErrorKind<span class="srust spunctuation saccessor">::</span></span>Parse</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust svariable sparameter">kind</span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure">FromFileError <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		path<span class="srust spunctuation sseparator">:</span> path.<span class="srust sfunction ssupport">into</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
		kind<span class="srust spunctuation sseparator">,</span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span></code></pre><p>Yeah, not the prettiest. Unfortunately, I don’t think there’s much we can actually do here; once we get <code class=scode>try</code> blocks it’ll definitely be nicer, but it seems to be an unavoidable cost of many good error-handling schemes.</p><h3 id=on-from><a href=#on-from class=anchor></a>On <code class=scode>From</code></h3><p>One thing notably omitted from the definitions of the new error types was implementations of <code class=scode>From</code> for inner types. There is no problem with them really, one just has to be careful that it (a) works with extensibility and (b) actually makes <em>sense</em>. For example, taking <code class=scode>FromFileErrorKind</code>:</p><pre class=scode><code><span class="srust ssource"><span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta senum"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype senum">enum</span> <span class="srust sentity sname senum">FromFileErrorKind</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	ReadFile<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">io<span class="srust spunctuation saccessor">::</span></span>Error</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
	Parse<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>ParseError</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span></code></pre><p>While it does make sense to implement <code class=scode>From&lt;ParseError></code>, because <code class=scode>Parse</code> is literally the name of one of the variants of <code class=scode>FromFileErrorKind</code>, it does not make sense to implement <code class=scode>From&lt;io::Error></code> because such an implementation would implicitly add meaning that one failed during the process of reading the file from disk (as the variant is named <code class=scode>ReadFile</code> instead of <code class=scode>Io</code>). Constraining the meaning of “any I/O error” to “an error reading the file from the disk” is helpful but should not be done implicitly, thus rendering <code class=scode>From</code> inappropriate.</p><h3 id=on-nearness><a href=#on-nearness class=anchor></a>On “nearness”</h3><p>One part of my principle of errors I haven’t yet touched on is the aspect of “nearness”; that errors should, as well as having an appropriate associated unit of fallibility, be sufficiently <em>near</em> to it. The fact is, with Rust’s current design you can’t put them as close as I’d like without sacrificing documentation quality. That is, while you’d ideally write something like:</p><pre class=scode><code><span class="srust ssource"><span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl"><span class="srust simpl sentity sname">Blocks</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sstorage smodifier">pub</span> <span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">from_file</span></span><span class="srust smeta sgeneric"><span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>P<span class="srust spunctuation sseparator">:</span> <span class="srust smeta sgeneric">AsRef<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>Path<span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">path</span><span class="srust spunctuation sseparator">:</span> P</span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">Self</span>, FromFileError<span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> <span class="srust sblock scomment"><span class="srust spunctuation sdefinition scomment">/*</span> … <span class="srust spunctuation sdefinition scomment">*/</span></span> </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta sstruct"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype sstruct">struct</span> </span><span class="srust smeta sstruct"><span class="srust sentity sname sstruct">FromFileError</span> </span><span class="srust smeta sstruct"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> <span class="srust sblock scomment"><span class="srust spunctuation sdefinition scomment">/*</span> … <span class="srust spunctuation sdefinition scomment">*/</span></span> </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl"><span class="srust simpl sentity sname">Blocks</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sstorage smodifier">pub</span> <span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">download</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">agent</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust smeta spath">ureq<span class="srust spunctuation saccessor">::</span></span>Agent</span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">Self</span>, DownloadError<span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> <span class="srust sblock scomment"><span class="srust spunctuation sdefinition scomment">/*</span> … <span class="srust spunctuation sdefinition scomment">*/</span></span> </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta sstruct"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype sstruct">struct</span> </span><span class="srust smeta sstruct"><span class="srust sentity sname sstruct">DownloadError</span> </span><span class="srust smeta sstruct"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> <span class="srust sblock scomment"><span class="srust spunctuation sdefinition scomment">/*</span> … <span class="srust spunctuation sdefinition scomment">*/</span></span> </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span></code></pre><p>This just makes your rustdoc look bad, since the <code class=scode><span class="srust ssource"><span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span></span></span></code> blocks are needlessly separated. So usually I end up writing something more like:</p><pre class=scode><code><span class="srust ssource"><span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl"><span class="srust simpl sentity sname">Blocks</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sstorage smodifier">pub</span> <span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">from_file</span></span><span class="srust smeta sgeneric"><span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>P<span class="srust spunctuation sseparator">:</span> <span class="srust smeta sgeneric">AsRef<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>Path<span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">path</span><span class="srust spunctuation sseparator">:</span> P</span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">Self</span>, FromFileError<span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> <span class="srust sblock scomment"><span class="srust spunctuation sdefinition scomment">/*</span> … <span class="srust spunctuation sdefinition scomment">*/</span></span> </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sstorage smodifier">pub</span> <span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">download</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">agent</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust smeta spath">ureq<span class="srust spunctuation saccessor">::</span></span>Agent</span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">Self</span>, DownloadError<span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> <span class="srust sblock scomment"><span class="srust spunctuation sdefinition scomment">/*</span> … <span class="srust spunctuation sdefinition scomment">*/</span></span> </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
<span class="srust smeta sstruct"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype sstruct">struct</span> </span><span class="srust smeta sstruct"><span class="srust sentity sname sstruct">FromFileError</span> </span><span class="srust smeta sstruct"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> <span class="srust sblock scomment"><span class="srust spunctuation sdefinition scomment">/*</span> … <span class="srust spunctuation sdefinition scomment">*/</span></span> </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
<span class="srust smeta sstruct"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype sstruct">struct</span> </span><span class="srust smeta sstruct"><span class="srust sentity sname sstruct">DownloadError</span> </span><span class="srust smeta sstruct"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> <span class="srust sblock scomment"><span class="srust spunctuation sdefinition scomment">/*</span> … <span class="srust spunctuation sdefinition scomment">*/</span></span> </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span></code></pre><p>It’s unfortunate, but I don’t think it’s terrible — you still get most the benefits of nearness.</p><p>The only thing to make sure of is that they stay in the same module; this same concept of “nearness” is a similar reason why one should be extremely wary of any module named “errors”, which is of equal organizational value to having a drawer labelled “medium-sized and flat”.</p><h3 id=verbosity><a href=#verbosity class=anchor></a>Verbosity</h3><p>Possibly the biggest objection to this style of error is the sheer number of lines of code required to implement it; error types aren’t a trivial number of lines, and making a new error type for every function can easily hugely increase the number of lines a library needs. This is definitely a valid criticism, I also find it tiresome to write the same things over and over again, but let me also offer an alternate perspective: rather than seeing it as simply a more verbose way to do the same thing, see it as due treatment for an oft ignored area.</p><p>Traditionally, errors as something to be pushed to the side as soon as possible to get on with “real” logic. But the art of resilient, reliable and user-friendly systems considers <em>all</em> outcomes, not just the successful one. As a success story, look no further than the Rust compiler itself; I don’t think it would be an exaggeration to say that Rust enjoys the current popularity it does <em>because of</em> how good its error messages are, and how much effort was put into it.</p><h2 id=conclusion><a href=#conclusion class=anchor></a>Conclusion</h2><p>This post is not here to give you a structure that you should follow for your errors. The structure I used as an example in this post had one specific use case, and filled it appropriately. If you find you can apply the same structure to your own code and it works well, then great! But really, what post is for is to get people to <em>start caring</em> about errors, putting actual thought into their designs, and learning how to elegantly pull off	ever-present balancing act between the five goals of good backtraces, extensibility, inspectability (matching), stability and modularity.</p><p>If there’s one thing I wish for you to take away, it’s that error handling is <em>hard</em>, but it’s <em>worth it</em> to learn. Because I’m tired of having to deal with lazy kitchen-sink-type errors.</p><details><summary>The final code</summary><pre class=scode><code><span class="srust ssource"><span class="srust scomment sline sdocumentation"><span class="srust spunctuation sdefinition scomment">//!</span> This crate provides types for UCD’s `Blocks.txt`.
</span>
<span class="srust smeta sstruct"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype sstruct">struct</span> </span><span class="srust smeta sstruct"><span class="srust sentity sname sstruct">Blocks</span> </span><span class="srust smeta sstruct"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust svariable smember sother">ranges</span><span class="srust spunctuation sseparator">:</span> <span class="srust smeta sgeneric">Vec<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sgeneric">RangeInclusive<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">u32</span><span class="srust spunctuation send sdefinition sgeneric">></span></span>, String<span class="srust spunctuation ssection sgroup send">)</span><span class="srust spunctuation send sdefinition sgeneric">></span></span>,
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl"><span class="srust simpl sentity sname">Blocks</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sstorage smodifier">pub</span> <span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">block_of</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span>, <span class="srust svariable sparameter">c</span><span class="srust spunctuation sseparator">:</span> <span class="srust sstorage stype">char</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust skeyword soperator">&</span><span class="srust sstorage stype">str</span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust svariable slanguage">self</span>.ranges
			.<span class="srust sfunction ssupport">binary_search_by</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust svariable sparameter">range</span><span class="srust spunctuation sseparator">,</span> _</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
				<span class="srust skeyword scontrol">if</span> <span class="srust skeyword soperator">*</span>range.<span class="srust sfunction ssupport">end</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">&lt;</span> <span class="srust sstorage stype">u32</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>from<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>c</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
					<span class="srust smeta spath">cmp<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">Ordering<span class="srust spunctuation saccessor">::</span></span>Less
				</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span> <span class="srust skeyword scontrol">else</span> <span class="srust skeyword scontrol">if</span> <span class="srust sstorage stype">u32</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>from<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>c</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">&lt;</span> <span class="srust skeyword soperator">*</span>range.<span class="srust sfunction ssupport">start</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
					<span class="srust smeta spath">cmp<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">Ordering<span class="srust spunctuation saccessor">::</span></span>Greater
				</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span> <span class="srust skeyword scontrol">else</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
					<span class="srust smeta spath">cmp<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">Ordering<span class="srust spunctuation saccessor">::</span></span>Equal
				</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
			</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			.<span class="srust sfunction ssupport">map</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust svariable sparameter">i</span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust skeyword soperator">&</span><span class="srust skeyword soperator">*</span><span class="srust svariable slanguage">self</span>.ranges<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">[</span>i<span class="srust spunctuation ssection sgroup send">]</span></span>.<span class="srust sconstant sdecimal sinteger snumeric">1</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			.<span class="srust sfunction ssupport">unwrap_or</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>No_Block<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sstorage smodifier">pub</span> <span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">from_file</span></span><span class="srust smeta sgeneric"><span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>P<span class="srust spunctuation sseparator">:</span> <span class="srust smeta sgeneric">AsRef<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>Path<span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">path</span><span class="srust spunctuation sseparator">:</span> P</span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">Self</span>, FromFileError<span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust sstorage stype">let</span> path <span class="srust skeyword soperator">=</span> path.<span class="srust sfunction ssupport">as_ref</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sterminator">;</span>
		<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>from_str<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust skeyword soperator">&</span><span class="srust smeta spath">fs<span class="srust spunctuation saccessor">::</span></span>read_to_string<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>path</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">FromFileErrorKind<span class="srust spunctuation saccessor">::</span></span>ReadFile</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
				.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">FromFileErrorKind<span class="srust spunctuation saccessor">::</span></span>Parse</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
		</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
		.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust svariable sparameter">kind</span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure">FromFileError <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
			path<span class="srust spunctuation sseparator">:</span> path.<span class="srust sfunction ssupport">into</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			kind<span class="srust spunctuation sseparator">,</span>
		</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sstorage smodifier">pub</span> <span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">download</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">agent</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust smeta spath">ureq<span class="srust spunctuation saccessor">::</span></span>Agent</span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">Self</span>, DownloadError<span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
			<span class="srust sstorage stype">let</span> response <span class="srust skeyword soperator">=</span> agent
				.<span class="srust sfunction ssupport">get</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sother sconstant">LATEST_URL</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
				.<span class="srust sfunction ssupport">call</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
				.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust svariable sparameter">e</span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust smeta spath">DownloadErrorKind<span class="srust spunctuation saccessor">::</span></span>Request<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust ssupport stype">Box</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>new<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>from_str<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>
				<span class="srust skeyword soperator">&</span>response
					.<span class="srust sfunction ssupport">into_string</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
					.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">DownloadErrorKind<span class="srust spunctuation saccessor">::</span></span>ReadBody</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sseparator">,</span>
			</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">DownloadErrorKind<span class="srust spunctuation saccessor">::</span></span>Parse</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
		</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
		.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust svariable sparameter">kind</span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure">DownloadError <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> kind </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">FromStr <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">Blocks</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust sstorage stype stype">type</span> <span class="srust sentity sname stype">Err</span> <span class="srust skeyword soperator">=</span> ParseError<span class="srust spunctuation sterminator">;</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">from_str</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust svariable sparameter">s</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage stype">str</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust sstorage stype">Self</span>, <span class="srust smeta spath"><span class="srust sstorage stype"><span class="srust sstorage stype">Self</span><span class="srust spunctuation saccessor">::</span></span></span>Err<span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust sstorage stype">let</span> ranges <span class="srust skeyword soperator">=</span> s
			.<span class="srust sfunction ssupport">lines</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			.<span class="srust sfunction ssupport">enumerate</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			.<span class="srust sfunction ssupport">map</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust svariable sparameter">i</span><span class="srust spunctuation sseparator">,</span> <span class="srust svariable sparameter">line</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
				<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>
					i<span class="srust spunctuation sseparator">,</span>
					line.<span class="srust sfunction ssupport">split_once</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted ssingle"><span class="srust spunctuation sbegin sdefinition sstring">'</span>#<span class="srust spunctuation send sdefinition sstring">'</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">map</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust svariable sparameter">line</span><span class="srust spunctuation sseparator">,</span> _</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure">line</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">unwrap_or</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>line</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
				</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			.<span class="srust sfunction ssupport">filter</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup">_<span class="srust spunctuation sseparator">,</span> <span class="srust svariable sparameter">line</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust skeyword soperator">!</span>line.<span class="srust sfunction ssupport">is_empty</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			.<span class="srust sfunction ssupport">map</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust svariable sparameter">i</span><span class="srust spunctuation sseparator">,</span> <span class="srust svariable sparameter">line</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
				<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
					<span class="srust sstorage stype">let</span> <span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>range<span class="srust spunctuation sseparator">,</span> name</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=</span> line.<span class="srust sfunction ssupport">split_once</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted ssingle"><span class="srust spunctuation sbegin sdefinition sstring">'</span>;<span class="srust spunctuation send sdefinition sstring">'</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">ok_or</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">ParseErrorKind<span class="srust spunctuation saccessor">::</span></span>NoSemicolon</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
					<span class="srust sstorage stype">let</span> <span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>range<span class="srust spunctuation sseparator">,</span> name</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=</span> <span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>range.<span class="srust sfunction ssupport">trim</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span> name.<span class="srust sfunction ssupport">trim</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sterminator">;</span>
					<span class="srust sstorage stype">let</span> <span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>start<span class="srust spunctuation sseparator">,</span> end</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=</span> range.<span class="srust sfunction ssupport">split_once</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>..<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">ok_or</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">ParseErrorKind<span class="srust spunctuation saccessor">::</span></span>NoDotDot</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
					<span class="srust sstorage stype">let</span> start <span class="srust skeyword soperator">=</span> <span class="srust sstorage stype">u32</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>from_str_radix<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>start<span class="srust spunctuation sseparator">,</span> <span class="srust sconstant sdecimal sinteger snumeric">16</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
						.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust svariable sparameter">source</span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust smeta spath">ParseErrorKind<span class="srust spunctuation saccessor">::</span></span>ParseInt <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> source </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
					<span class="srust sstorage stype">let</span> end <span class="srust skeyword soperator">=</span> <span class="srust sstorage stype">u32</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>from_str_radix<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>end<span class="srust spunctuation sseparator">,</span> <span class="srust sconstant sdecimal sinteger snumeric">16</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
						.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust svariable sparameter">source</span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure"><span class="srust smeta spath">ParseErrorKind<span class="srust spunctuation saccessor">::</span></span>ParseInt <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> source </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
					<span class="srust ssupport stype">Ok</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>start<span class="srust skeyword soperator">..</span><span class="srust skeyword soperator">=</span>end<span class="srust spunctuation sseparator">,</span> name.<span class="srust sfunction ssupport">to_owned</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
				</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
				.<span class="srust sfunction ssupport">map_err</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">|</span></span></span><span class="srust smeta sfunction sclosure"><span class="srust smeta sfunction sparameters"><span class="srust svariable sparameter">kind</span><span class="srust spunctuation ssection send sparameters">|</span></span> </span><span class="srust smeta sfunction sclosure">ParseError <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> line<span class="srust spunctuation sseparator">:</span> i<span class="srust spunctuation sseparator">,</span> kind </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			.<span class="srust smeta spath">collect<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta sgeneric"><span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust smeta sgeneric">Result<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust smeta sgeneric">Vec<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust skeyword soperator">_</span><span class="srust spunctuation send sdefinition sgeneric">></span></span>, ParseError<span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust skeyword soperator">?</span><span class="srust spunctuation sterminator">;</span>
		<span class="srust ssupport stype">Ok</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstorage stype">Self</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> ranges </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sstruct"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype sstruct">struct</span> </span><span class="srust smeta sstruct"><span class="srust sentity sname sstruct">DownloadError</span> </span><span class="srust smeta sstruct"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust sstorage smodifier">pub</span> <span class="srust svariable smember sother">kind</span><span class="srust spunctuation sseparator">:</span> DownloadErrorKind,
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Display <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">DownloadError</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">fmt</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span>, <span class="srust svariable sparameter">f</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage smodifier">mut</span> <span class="srust smeta sgeneric">Formatter<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>'<span class="srust skeyword soperator">_</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Result</span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust ssupport smacro">write!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup">f,</span><span class="srust smeta sgroup"> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>failed to download Blocks.txt from the Unicode website<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Error <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">DownloadError</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">source</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Option<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust skeyword soperator">&</span><span class="srust spunctuation ssection sgroup sbegin">(</span>dyn Error + <span class="srust sstorage smodifier slifetime">'static</span><span class="srust spunctuation ssection sgroup send">)</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust skeyword scontrol">match</span> <span class="srust skeyword soperator">&</span><span class="srust svariable slanguage">self</span>.kind <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
			<span class="srust smeta spath">DownloadErrorKind<span class="srust spunctuation saccessor">::</span></span>Request<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust smeta spath">DownloadErrorKind<span class="srust spunctuation saccessor">::</span></span>ReadBody<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust smeta spath">DownloadErrorKind<span class="srust spunctuation saccessor">::</span></span>Parse<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
		</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta senum"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype senum">enum</span> <span class="srust sentity sname senum">DownloadErrorKind</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	Request<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta sgeneric">Box<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust smeta spath">ureq<span class="srust spunctuation saccessor">::</span></span>Error<span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
	ReadBody<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">io<span class="srust spunctuation saccessor">::</span></span>Error</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
	Parse<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>ParseError</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sstruct"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype sstruct">struct</span> </span><span class="srust smeta sstruct"><span class="srust sentity sname sstruct">FromFileError</span> </span><span class="srust smeta sstruct"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust sstorage smodifier">pub</span> <span class="srust svariable smember sother">path</span><span class="srust spunctuation sseparator">:</span> <span class="srust smeta sgeneric">Box<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>Path<span class="srust spunctuation send sdefinition sgeneric">></span></span>,
	<span class="srust sstorage smodifier">pub</span> <span class="srust svariable smember sother">kind</span><span class="srust spunctuation sseparator">:</span> FromFileErrorKind,
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Display <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">FromFileError</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">fmt</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span>, <span class="srust svariable sparameter">f</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage smodifier">mut</span> <span class="srust smeta sgeneric">Formatter<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>'<span class="srust skeyword soperator">_</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Result</span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust ssupport smacro">write!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup">f,</span><span class="srust smeta sgroup"> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>error reading `<span class="srust sother sconstant splaceholder">{}</span>`<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation sseparator">,</span> <span class="srust svariable slanguage">self</span>.path.<span class="srust sfunction ssupport">display</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Error <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">FromFileError</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">source</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Option<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust skeyword soperator">&</span><span class="srust spunctuation ssection sgroup sbegin">(</span>dyn Error + <span class="srust sstorage smodifier slifetime">'static</span><span class="srust spunctuation ssection sgroup send">)</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust skeyword scontrol">match</span> <span class="srust skeyword soperator">&</span><span class="srust svariable slanguage">self</span>.kind <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
			<span class="srust smeta spath">FromFileErrorKind<span class="srust spunctuation saccessor">::</span></span>ReadFile<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust smeta spath">FromFileErrorKind<span class="srust spunctuation saccessor">::</span></span>Parse<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>e</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
		</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta senum"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype senum">enum</span> <span class="srust sentity sname senum">FromFileErrorKind</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	ReadFile<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust smeta spath">io<span class="srust spunctuation saccessor">::</span></span>Error</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
	Parse<span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>ParseError</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta sstruct"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype sstruct">struct</span> </span><span class="srust smeta sstruct"><span class="srust sentity sname sstruct">ParseError</span> </span><span class="srust smeta sstruct"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust sstorage smodifier">pub</span> <span class="srust svariable smember sother">line</span><span class="srust spunctuation sseparator">:</span> <span class="srust sstorage stype">usize</span>,
	<span class="srust sstorage smodifier">pub</span> <span class="srust svariable smember sother">kind</span><span class="srust spunctuation sseparator">:</span> ParseErrorKind,
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Display <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">ParseError</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">fmt</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span>, <span class="srust svariable sparameter">f</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage smodifier">mut</span> <span class="srust smeta sgeneric">Formatter<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>'<span class="srust skeyword soperator">_</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Result</span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust ssupport smacro">write!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup">f,</span><span class="srust smeta sgroup"> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>invalid Blocks.txt data on line <span class="srust sother sconstant splaceholder">{}</span><span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation sseparator">,</span> <span class="srust svariable slanguage">self</span>.line <span class="srust skeyword soperator">+</span> <span class="srust sconstant sdecimal sinteger snumeric">1</span><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Error <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">ParseError</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">source</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Option<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust skeyword soperator">&</span><span class="srust spunctuation ssection sgroup sbegin">(</span>dyn Error + <span class="srust sstorage smodifier slifetime">'static</span><span class="srust spunctuation ssection sgroup send">)</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable slanguage">self</span>.kind</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">derive</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">Debug</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta senum"><span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype senum">enum</span> <span class="srust sentity sname senum">ParseErrorKind</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
	NoSemicolon<span class="srust spunctuation sseparator">,</span>
	<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
	NoDotDot<span class="srust spunctuation sseparator">,</span>
	<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">non_exhaustive</span><span class="srust spunctuation ssection sgroup send">]</span></span>
	ParseInt <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> source<span class="srust spunctuation sseparator">:</span> ParseIntError </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span><span class="srust spunctuation sseparator">,</span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Display <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">ParseErrorKind</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">fmt</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span>, <span class="srust svariable sparameter">f</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage smodifier">mut</span> <span class="srust smeta sgeneric">Formatter<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>'<span class="srust skeyword soperator">_</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Result</span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust skeyword scontrol">match</span> <span class="srust skeyword soperator">*</span><span class="srust svariable slanguage">self</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>NoSemicolon <span class="srust skeyword soperator">=></span> f.<span class="srust sfunction ssupport">write_str</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>no semicolon<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>NoDotDot <span class="srust skeyword soperator">=></span> f.<span class="srust sfunction ssupport">write_str</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>no `..` in range<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>ParseInt <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> <span class="srust skeyword soperator">..</span> </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span> <span class="srust skeyword soperator">=></span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
				<span class="srust ssupport smacro">write!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup">f,</span><span class="srust smeta sgroup"> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>one end of range is not a valid hexadecimal integer<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>
			</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
		</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta simpl"><span class="srust sstorage stype simpl">impl</span> </span><span class="srust smeta simpl">Error <span class="srust skeyword sother">for</span></span><span class="srust smeta simpl"> <span class="srust simpl sentity sname">ParseErrorKind</span> </span><span class="srust smeta simpl"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">source</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span><span class="srust skeyword soperator">&</span><span class="srust svariable sparameter">self</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> <span class="srust smeta sfunction sreturn-type"><span class="srust spunctuation sseparator">-></span> <span class="srust smeta sgeneric">Option<span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span><span class="srust skeyword soperator">&</span><span class="srust spunctuation ssection sgroup sbegin">(</span>dyn Error + <span class="srust sstorage smodifier slifetime">'static</span><span class="srust spunctuation ssection sgroup send">)</span><span class="srust spunctuation send sdefinition sgeneric">></span></span></span> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust skeyword scontrol">match</span> <span class="srust svariable slanguage">self</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
			<span class="srust sstorage stype">Self</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>ParseInt <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span> source </span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">Some</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>source</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span>
			<span class="srust skeyword soperator">_</span> <span class="srust skeyword soperator">=></span> <span class="srust ssupport stype">None</span><span class="srust spunctuation sseparator">,</span>
		</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">cfg</span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup">test</span></span><span class="srust smeta sparameters sannotation"><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span></span><span class="srust spunctuation ssection sgroup send">]</span></span>
<span class="srust smeta smodule"><span class="srust sstorage stype smodule">mod</span> <span class="srust sentity sname smodule">tests</span> <span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
	<span class="srust smeta sannotation"><span class="srust spunctuation sdefinition sannotation">#</span><span class="srust spunctuation ssection sgroup sbegin">[</span><span class="srust sannotation svariable">test</span><span class="srust spunctuation ssection sgroup send">]</span></span>
	<span class="srust smeta sfunction"><span class="srust smeta sfunction"><span class="srust sfunction sstorage stype">fn</span> </span><span class="srust sfunction sentity sname">real_unicode</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection sbegin sparameters">(</span></span><span class="srust smeta sfunction"><span class="srust smeta sfunction sparameters"><span class="srust spunctuation ssection send sparameters">)</span></span></span></span><span class="srust smeta sfunction"> </span><span class="srust smeta sfunction"><span class="srust smeta sblock"><span class="srust spunctuation ssection sbegin sblock">{</span>
		<span class="srust sstorage stype">let</span> data <span class="srust skeyword soperator">=</span> <span class="srust ssupport smacro">include_str!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>../Blocks.txt<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust smeta spath">parse<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta sgeneric"><span class="srust spunctuation sbegin sdefinition sgeneric">&lt;</span>Blocks<span class="srust spunctuation send sdefinition sgeneric">></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span>.<span class="srust sfunction ssupport">unwrap</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sterminator">;</span>
		<span class="srust ssupport smacro">assert_eq!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>data.<span class="srust sfunction ssupport">block_of</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted ssingle"><span class="srust spunctuation sbegin sdefinition sstring">'</span><span class="srust sconstant scharacter sescape">\u{0080}</span><span class="srust spunctuation send sdefinition sstring">'</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>Latin-1 Supplement<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sterminator">;</span>
		<span class="srust ssupport smacro">assert_eq!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>data.<span class="srust sfunction ssupport">block_of</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted ssingle"><span class="srust spunctuation sbegin sdefinition sstring">'</span>½<span class="srust spunctuation send sdefinition sstring">'</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>Latin-1 Supplement<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sterminator">;</span>
		<span class="srust ssupport smacro">assert_eq!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>data.<span class="srust sfunction ssupport">block_of</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted ssingle"><span class="srust spunctuation sbegin sdefinition sstring">'</span><span class="srust sconstant scharacter sescape">\u{00FF}</span><span class="srust spunctuation send sdefinition sstring">'</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>Latin-1 Supplement<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sterminator">;</span>
		<span class="srust ssupport smacro">assert_eq!</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span>data.<span class="srust sfunction ssupport">block_of</span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup sbegin">(</span><span class="srust sstring squoted ssingle"><span class="srust spunctuation sbegin sdefinition sstring">'</span><span class="srust sconstant scharacter sescape">\u{EFFFF}</span><span class="srust spunctuation send sdefinition sstring">'</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sseparator">,</span> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>No_Block<span class="srust spunctuation send sdefinition sstring">"</span></span></span><span class="srust smeta sgroup"><span class="srust spunctuation ssection sgroup send">)</span></span><span class="srust spunctuation sterminator">;</span>
	</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

	<span class="srust skeyword sother">use</span> <span class="srust skeyword sother">crate</span><span class="srust smeta spath"><span class="srust spunctuation saccessor">::</span></span>Blocks<span class="srust spunctuation sterminator">;</span>
</span><span class="srust smeta sblock"><span class="srust spunctuation ssection send sblock">}</span></span></span>

<span class="srust sstorage smodifier">pub</span> <span class="srust sstorage stype">const</span> <span class="srust sother sconstant">LATEST_URL</span><span class="srust spunctuation sseparator">:</span> <span class="srust skeyword soperator">&</span><span class="srust sstorage stype">str</span> <span class="srust skeyword soperator">=</span> <span class="srust sstring squoted sdouble"><span class="srust spunctuation sbegin sdefinition sstring">"</span>https://www.unicode.org/Public/UCD/latest/ucd/Blocks.txt<span class="srust spunctuation send sdefinition sstring">"</span></span><span class="srust spunctuation sterminator">;</span>

<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span>cmp<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">error<span class="srust spunctuation saccessor">::</span></span>Error<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span>fmt<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Display<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">fmt<span class="srust spunctuation saccessor">::</span></span>Formatter<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span>fs<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span>io<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">num<span class="srust spunctuation saccessor">::</span></span>ParseIntError<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">ops<span class="srust spunctuation saccessor">::</span></span>RangeInclusive<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">path<span class="srust spunctuation saccessor">::</span></span>Path<span class="srust spunctuation sterminator">;</span>
<span class="srust skeyword sother">use</span> <span class="srust smeta spath">std<span class="srust spunctuation saccessor">::</span></span><span class="srust smeta spath">str<span class="srust spunctuation saccessor">::</span></span>FromStr<span class="srust spunctuation sterminator">;</span>
</span></code></pre></details><p class=back><a href=#>⮬ Back to top</a></p></main></body></html>