<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><title>Sabrina Jewson&apos;s Blog</title><id>https://www.sabrinajewson.org/blog/</id><updated>2022-03-09T00:00:00+00:00</updated><author><name>Sabrina Jewson</name><uri>https://www.sabrinajewson.org</uri></author><generator uri="https://github.com/SabrinaJewson/sabrinajewson.github.io">sabrinajewson.github.io</generator><icon>https://www.sabrinajewson.org/apple-touch-icon.png</icon><link href="https://www.sabrinajewson.org/blog/feed.xml" rel="self" type="application/atom+xml"/><link href="https://www.sabrinajewson.org/blog/" rel="alternate" type="text/html"/><entry><title>Building this site</title><id>https://www.sabrinajewson.org/blog/building-this-site</id><updated>2022-03-09T00:00:00+00:00</updated><link href="https://www.sabrinajewson.org/blog/building-this-site" rel="alternate" type="text/html" title="Building this site"/><published>2022-03-09T00:00:00+00:00</published><content xml:base="https://www.sabrinajewson.org/blog/building-this-site" type="html">&lt;p&gt;Since I’ve spent the past few days working on creating this website, I thought I’d make good use of the effort by documenting my experiences here.&lt;/p&gt;&lt;p&gt;I got the idea to create a website from a desire to have a place to write blog posts. Initially I had plans on just making GitHub gists and sharing them on Reddit or something, but I (thankfully) decided against that since a site allows for much more flexibility.&lt;/p&gt;&lt;p&gt;To avoid having to maintain a web server myself, I’m just using GitHub Pages to host it (but on a custom domain to make the URL shorter). I also decided against using a static site generator since it’s a lot more fun to build it myself.&lt;/p&gt;&lt;h2 id=&apos;the-build-system&apos;&gt;&lt;a href=&apos;#the-build-system&apos; class=&apos;anchor&apos;&gt;&lt;/a&gt;The build system&lt;/h2&gt;&lt;p&gt;I’m not going to write the HTML for this manually, so I needed to decide on a build system to use. I briefly considered existing options like Make, &lt;a href=&apos;https://gulpjs.com/&apos;&gt;Gulp&lt;/a&gt; or &lt;a href=&apos;https://sagiegurari.github.io/cargo-make/&apos;&gt;cargo-make&lt;/a&gt; but eventually decided to write my own thing in Rust.&lt;/p&gt;&lt;p&gt;The requirements I had for it were this:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Does the minimum amount of work possible between rebuilds.&lt;/li&gt;&lt;li&gt;Has a “watch mode” that can be enabled with zero extra configuration to watch the directory for changes and automatically rebuild when they happen.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;After some thinking and a few failed attempts, I had devised quite a neat solution: the &lt;code class=&apos;scode&apos;&gt;Asset&lt;/code&gt; trait. The core API is this:&lt;/p&gt;&lt;pre class=&apos;scode&apos;&gt;&lt;code&gt;&lt;span class=&quot;ssource srust&quot;&gt;&lt;span class=&quot;smeta strait srust&quot;&gt;&lt;span class=&quot;sstorage stype strait srust&quot;&gt;trait&lt;/span&gt; &lt;span class=&quot;sentity sname strait srust&quot;&gt;Asset&lt;/span&gt; &lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;sstorage stype stype srust&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;sentity sname stype srust&quot;&gt;Output&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; Modified&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;generate&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;Self&lt;/span&gt;&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;Output&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;smeta senum srust&quot;&gt;&lt;span class=&quot;sstorage stype senum srust&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;sentity sname senum srust&quot;&gt;Modified&lt;/span&gt; &lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    Never&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt;
    At&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;SystemTime&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Each &lt;code class=&apos;scode&apos;&gt;Asset&lt;/code&gt; represents a resource in the generation process: a text file being read, a JSON file being parsed, an HTML file being generated, an image being tranformed, et cetera. It has two main capabilities: calling &lt;code class=&apos;scode&apos;&gt;generate&lt;/code&gt; to do the (potentially expensive) work to actually produce the value, and calling &lt;code class=&apos;scode&apos;&gt;modified&lt;/code&gt; to cheaply compute the time at which that value was last modified.&lt;/p&gt;&lt;p&gt;The &lt;code class=&apos;scode&apos;&gt;Modified&lt;/code&gt; enum is mostly just a &lt;code class=&apos;scode&apos;&gt;SystemTime&lt;/code&gt; but also has a special variant &lt;code class=&apos;scode&apos;&gt;Never&lt;/code&gt; to represent a time before all &lt;code class=&apos;scode&apos;&gt;SystemTime&lt;/code&gt;s, which is used for when getting the modification time fails (e.g. a deleted/non-existent file) or when the asset’s value is a constant.&lt;/p&gt;&lt;p&gt;The three most basic implementors of this trait are &lt;code class=&apos;scode&apos;&gt;Constant&lt;/code&gt;, &lt;code class=&apos;scode&apos;&gt;Dynamic&lt;/code&gt; and &lt;code class=&apos;scode&apos;&gt;FsPath&lt;/code&gt;, representing a constant value, a dynamic but immutable value (typically command-line arguments) and a value sourced from a filesystem path’s modification time respectively. Their implementations are pretty much as you’d expect:&lt;/p&gt;&lt;pre class=&apos;scode&apos;&gt;&lt;code&gt;&lt;span class=&quot;ssource srust&quot;&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;sstorage stype sstruct srust&quot;&gt;struct&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;sentity sname sstruct srust&quot;&gt;Constant&lt;/span&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;T&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;sstorage stype simpl srust&quot;&gt;impl&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; Clone&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt; Asset &lt;span class=&quot;skeyword sother srust&quot;&gt;for&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt; &lt;span class=&quot;sentity sname simpl srust&quot;&gt;Constant&lt;/span&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;sstorage stype stype srust&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;sentity sname stype srust&quot;&gt;Output&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; T&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; Modified&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;Modified&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;Never &lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;generate&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;Self&lt;/span&gt;&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;Output&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;.&lt;span class=&quot;sconstant snumeric sfloat srust&quot;&gt;0.&lt;/span&gt;&lt;span class=&quot;ssupport sfunction srust&quot;&gt;clone&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;sstorage stype sstruct srust&quot;&gt;struct&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;sentity sname sstruct srust&quot;&gt;Dynamic&lt;/span&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt; &lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;svariable sother smember srust&quot;&gt;created&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; SystemTime,
    &lt;span class=&quot;svariable sother smember srust&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; T,
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;sstorage stype simpl srust&quot;&gt;impl&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt; &lt;span class=&quot;sentity sname simpl srust&quot;&gt;Dynamic&lt;/span&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;new&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; T&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;sstorage stype srust&quot;&gt;Self&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;sstorage stype srust&quot;&gt;let&lt;/span&gt; created &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;SystemTime&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;now&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;sstorage stype srust&quot;&gt;Self&lt;/span&gt; &lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt; created&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt; value &lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
    &lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;sstorage stype simpl srust&quot;&gt;impl&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; Clone&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt; Asset &lt;span class=&quot;skeyword sother srust&quot;&gt;for&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt; &lt;span class=&quot;sentity sname simpl srust&quot;&gt;Dynamic&lt;/span&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;T&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;sstorage stype stype srust&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;sentity sname stype srust&quot;&gt;Output&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; T&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; Modified&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;Modified&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;At&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;.created&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;generate&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;Self&lt;/span&gt;&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;Output&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;.value.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;clone&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;sstorage stype sstruct srust&quot;&gt;struct&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;sentity sname sstruct srust&quot;&gt;FsPath&lt;/span&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;P&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;P&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;sstorage stype simpl srust&quot;&gt;impl&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;P&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;smeta sgeneric srust&quot;&gt;AsRef&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;Path&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt; Asset &lt;span class=&quot;skeyword sother srust&quot;&gt;for&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt; &lt;span class=&quot;sentity sname simpl srust&quot;&gt;FsPath&lt;/span&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;P&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;sstorage stype stype srust&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;sentity sname stype srust&quot;&gt;Output&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; Modified&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;smeta spath srust&quot;&gt;fs&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;symlink_metadata&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;.&lt;span class=&quot;sconstant snumeric sinteger sdecimal srust&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
            .&lt;span class=&quot;ssupport sfunction srust&quot;&gt;and_then&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;metadata.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
            .&lt;span class=&quot;ssupport sfunction srust&quot;&gt;map_or&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta spath srust&quot;&gt;Modified&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;Never&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;Modified&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;At&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
    &lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;generate&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;Self&lt;/span&gt;&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;Output&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code class=&apos;scode&apos;&gt;FsPath&lt;/code&gt; is intentionally agnostic over how the actual path is read, allowing you to many different functions depending on the actual nature of the path (whether it’s a binary file, text file, JSON file, directory, et cetera).&lt;/p&gt;&lt;p&gt;With these base types there are then many combinators you can apply. One basic one is &lt;code class=&apos;scode&apos;&gt;all&lt;/code&gt;, which combines multiple &lt;code class=&apos;scode&apos;&gt;Asset&lt;/code&gt;s into one for when a resulting asset is generated from more than one input file (such as this HTML file, which is generated from the source markdown and a template). It works on all kinds of containers of multiple assets including tuples and vectors. Example usage looks like:&lt;/p&gt;&lt;pre class=&apos;scode&apos;&gt;&lt;code&gt;&lt;span class=&quot;ssource srust&quot;&gt;&lt;span class=&quot;smeta spath srust&quot;&gt;asset&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;all&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;foo_asset&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt; bar_asset&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
	.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;foo_value&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;svariable sparameter srust&quot;&gt;bar_value&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;scomment sblock srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition scomment srust&quot;&gt;/*&lt;/span&gt; use both `foo_value` and `bar_value` &lt;span class=&quot;spunctuation sdefinition scomment srust&quot;&gt;*/&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Its &lt;code class=&apos;scode&apos;&gt;modified&lt;/code&gt; implementation takes the latest modification time of all the inner assets, and its &lt;code class=&apos;scode&apos;&gt;generate&lt;/code&gt; implementation just forwards to the generation code of each one then packages them all up together in a tuple. However, you might notice a problem here: with the code above, if &lt;code class=&apos;scode&apos;&gt;bar&lt;/code&gt; is changed but &lt;code class=&apos;scode&apos;&gt;foo&lt;/code&gt; isn’t then both &lt;code class=&apos;scode&apos;&gt;foo&lt;/code&gt; &lt;em&gt;and&lt;/em&gt; &lt;code class=&apos;scode&apos;&gt;bar&lt;/code&gt; are regenerated even if only &lt;code class=&apos;scode&apos;&gt;bar&lt;/code&gt; actually needs to be.&lt;/p&gt;&lt;p&gt;This is where another combinator comes in: &lt;code class=&apos;scode&apos;&gt;Cache&lt;/code&gt;. It provides an in-memory cache of the output’s value (as long as it is &lt;code class=&apos;scode&apos;&gt;Clone&lt;/code&gt;), allowing cases like the above to simply use the cached value of &lt;code class=&apos;scode&apos;&gt;foo&lt;/code&gt; instead of regenerating it from scratch.&lt;/p&gt;&lt;pre class=&apos;scode&apos;&gt;&lt;code&gt;&lt;span class=&quot;ssource srust&quot;&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;sstorage stype sstruct srust&quot;&gt;struct&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;sentity sname sstruct srust&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;A&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; Asset&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt; &lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;svariable sother smember srust&quot;&gt;asset&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; A,
    &lt;span class=&quot;svariable sother smember srust&quot;&gt;cached&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;smeta sgeneric srust&quot;&gt;Cell&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;Option&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;Modified, &lt;span class=&quot;smeta spath srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;Output&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;,
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;sstorage stype simpl srust&quot;&gt;impl&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;A&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; Asset&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt; Asset &lt;span class=&quot;skeyword sother srust&quot;&gt;for&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt; &lt;span class=&quot;sentity sname simpl srust&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;A&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;skeyword sother srust&quot;&gt;where&lt;/span&gt;
    &lt;span class=&quot;smeta spath srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;Output&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; Clone,
&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;sstorage stype stype srust&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;sentity sname stype srust&quot;&gt;Output&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;A&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;Output&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; Modified&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;.asset.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
    &lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;generate&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;Self&lt;/span&gt;&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;Output&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;sstorage stype srust&quot;&gt;let&lt;/span&gt; inner_modified &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;.asset.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;sstorage stype srust&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;last_modified&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt; output&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;
            .cached
            .&lt;span class=&quot;ssupport sfunction srust&quot;&gt;take&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
            .&lt;span class=&quot;ssupport sfunction srust&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;last_modified&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt; _&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;last_modified &lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; inner_modified&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
            .&lt;span class=&quot;ssupport sfunction srust&quot;&gt;unwrap_or_else&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;inner_modified&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;.asset.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;.cached.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ssupport stype srust&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;last_modified&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt; output.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;clone&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
        output
    &lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;In the code snippet above, the &lt;code class=&apos;scode&apos;&gt;generate&lt;/code&gt; function of &lt;code class=&apos;scode&apos;&gt;Cache&lt;/code&gt; will first attempt to use the cached value instead of regenerating the asset if the inner asset hasn’t been modified since the cache was taken.&lt;/p&gt;&lt;p&gt;Another place where &lt;code class=&apos;scode&apos;&gt;Cache&lt;/code&gt; is useful is when an asset is shared between multiple output assets (like how my “blog post template” asset is shared with every blog post), and &lt;code class=&apos;scode&apos;&gt;Cache&lt;/code&gt; can be applied to avoid regenerating the shared asset every time.&lt;/p&gt;&lt;p&gt;The last combinator I will talk about here is called &lt;code class=&apos;scode&apos;&gt;ModifiesPath&lt;/code&gt;, and it is perhaps the most important one. You can apply it to an asset that as a side-effect makes changes to a path on the filesystem, and it allows that asset to avoid rerunning itself when the asset’s age is older than the path it modifies.&lt;/p&gt;&lt;pre class=&apos;scode&apos;&gt;&lt;code&gt;&lt;span class=&quot;ssource srust&quot;&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;sstorage stype sstruct srust&quot;&gt;struct&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;sentity sname sstruct srust&quot;&gt;ModifiesPath&lt;/span&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;A, P&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt; &lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;svariable sother smember srust&quot;&gt;asset&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; A,
    &lt;span class=&quot;svariable sother smember srust&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; P,
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;sstorage stype simpl srust&quot;&gt;impl&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;A&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;smeta sgeneric srust&quot;&gt;Asset&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;Output = &lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;, P&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;smeta sgeneric srust&quot;&gt;AsRef&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;Path&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt; Asset &lt;span class=&quot;skeyword sother srust&quot;&gt;for&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt; &lt;span class=&quot;sentity sname simpl srust&quot;&gt;ModifiesPath&lt;/span&gt;&lt;span class=&quot;smeta sgeneric srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;A, P&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta simpl srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;sstorage stype stype srust&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;sentity sname stype srust&quot;&gt;Output&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; Modified&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;smeta spath srust&quot;&gt;fs&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;symlink_metadata&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;.path&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
            .&lt;span class=&quot;ssupport sfunction srust&quot;&gt;and_then&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;metadata.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
            .&lt;span class=&quot;ssupport sfunction srust&quot;&gt;map_or&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta spath srust&quot;&gt;Modified&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;Never&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;Modified&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;At&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
    &lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;generate&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;self&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;&lt;span class=&quot;sstorage stype srust&quot;&gt;Self&lt;/span&gt;&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;Output&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;sstorage stype srust&quot;&gt;let&lt;/span&gt; output_modified &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;skeyword scontrol srust&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;.asset.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; output_modified
			&lt;span class=&quot;skeyword soperator srust&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;sconstant sother srust&quot;&gt;EXE_MODIFIED&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; output_modified
		&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;svariable slanguage srust&quot;&gt;self&lt;/span&gt;.asset.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
        &lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
    &lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;sstorage stype srust&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;sconstant sother srust&quot;&gt;EXE_MODIFIED&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;smeta sgeneric srust&quot;&gt;Lazy&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;Modified&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;Lazy&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;new&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;sstorage stype srust&quot;&gt;let&lt;/span&gt; time &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;env&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;current_exe&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
		.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;and_then&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta spath srust&quot;&gt;fs&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;symlink_metadata&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
		.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;and_then&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;svariable sparameter srust&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;metadata.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;modified&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
		.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;unwrap_or_else&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;_&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta spath srust&quot;&gt;SystemTime&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;now&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;smeta spath srust&quot;&gt;Modified&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;At&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;time&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;It is this combinator that allows the Make-like behaviour of comparing ages of input and output files and only rebuilding when necessary.&lt;/p&gt;&lt;p&gt;The other thing &lt;code class=&apos;scode&apos;&gt;ModifiesPath&lt;/code&gt; does is takes into account the age of the executable it is running in, forcing a rebuild if the executable itself has been changed since the output was last generated. This is very useful during development to avoid situations where you need to manually remove the destination directory to force assets to be rebuilt.&lt;/p&gt;&lt;p&gt;The combination of all these features forms a very powerful build system implemented in simple Rust code. For example, suppose I wanted to make a build script that copies over &lt;code class=&apos;scode&apos;&gt;source.txt&lt;/code&gt; to &lt;code class=&apos;scode&apos;&gt;destination.txt&lt;/code&gt;. That would look like this:&lt;/p&gt;&lt;pre class=&apos;scode&apos;&gt;&lt;code&gt;&lt;span class=&quot;ssource srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;main&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;sstorage stype srust&quot;&gt;let&lt;/span&gt; asset &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;ssupport sfunction srust&quot;&gt;source_to_dest&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
	asset.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;source_to_dest&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; impl &lt;span class=&quot;smeta sgeneric srust&quot;&gt;Asset&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;Output = &lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;smeta spath srust&quot;&gt;asset&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta spath srust&quot;&gt;FsPath&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;new&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sstring squoted sdouble srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin srust&quot;&gt;&amp;quot;&lt;/span&gt;source.txt&lt;span class=&quot;spunctuation sdefinition sstring send srust&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
		.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;sstorage stype srust&quot;&gt;let&lt;/span&gt; res &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;fs&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;copy&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sstring squoted sdouble srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin srust&quot;&gt;&amp;quot;&lt;/span&gt;source.txt&lt;span class=&quot;spunctuation sdefinition sstring send srust&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sstring squoted sdouble srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin srust&quot;&gt;&amp;quot;&lt;/span&gt;destination.txt&lt;span class=&quot;spunctuation sdefinition sstring send srust&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;skeyword scontrol srust&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;sstorage stype srust&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;ssupport stype srust&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;e&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; res &lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;smeta spath srust&quot;&gt;log&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;error&lt;span class=&quot;skeyword soperator srust&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sstring squoted sdouble srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin srust&quot;&gt;&amp;quot;&lt;/span&gt;error copying files: {e}&lt;span class=&quot;spunctuation sdefinition sstring send srust&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
			&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
		&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
		.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;modifies_path&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sstring squoted sdouble srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin srust&quot;&gt;&amp;quot;&lt;/span&gt;destination.txt&lt;span class=&quot;spunctuation sdefinition sstring send srust&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And just like that, we have automatic tracking of dependencies done for free. Now suppose I wanted to add a “watch” mode that waits for changes to &lt;code class=&apos;scode&apos;&gt;source.txt&lt;/code&gt; to happen and copies it over again. Absolutely no changes to the &lt;code class=&apos;scode&apos;&gt;source_to_dest&lt;/code&gt; function are needed, all we have to do is layer some code using &lt;a href=&apos;https://github.com/notify-rs/notify&apos;&gt;&lt;code class=&apos;scode&apos;&gt;notify&lt;/code&gt;&lt;/a&gt; on top of that:&lt;/p&gt;&lt;pre class=&apos;scode&apos;&gt;&lt;code&gt;&lt;span class=&quot;ssource srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;main&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;sstorage stype srust&quot;&gt;let&lt;/span&gt; asset &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;ssupport sfunction srust&quot;&gt;source_to_dest&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
	asset.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;sstorage stype srust&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;events_sender&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt; events&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;crossbeam_channel&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;bounded&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sconstant snumeric sinteger sdecimal srust&quot;&gt;16&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;sstorage stype srust&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;sstorage smodifier srust&quot;&gt;mut&lt;/span&gt; watcher &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;notify&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;recommended_watcher&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;events_sender&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
	watcher.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;watch&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sstring squoted sdouble srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin srust&quot;&gt;&amp;quot;&lt;/span&gt;.&lt;span class=&quot;spunctuation sdefinition sstring send srust&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;as_ref&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;smeta spath srust&quot;&gt;notify&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta spath srust&quot;&gt;RecursiveMode&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;Recursive&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;unwrap&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;skeyword scontrol srust&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;sstorage stype srust&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;skeyword soperator srust&quot;&gt;=&lt;/span&gt; events.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;recv&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;unwrap&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;unwrap&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
		asset.&lt;span class=&quot;ssupport sfunction srust&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator srust&quot;&gt;;&lt;/span&gt;
	&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And there we are, everything is handled automatically from that point onward. Due to the in-memory caching and on-disk comparison that assets usually perform it ends up being pretty efficient, doing close to the minimum amount of work necessary between rebuilds. It could theoretically be improved if the &lt;em&gt;contents&lt;/em&gt; of the &lt;code class=&apos;scode&apos;&gt;notify::Event&lt;/code&gt;s were actually paid attention to instead of having to repeatedly call &lt;code class=&apos;scode&apos;&gt;fs::symlink_metadata&lt;/code&gt; a bunch, but I haven’t had a need to implement that just yet.&lt;/p&gt;&lt;p&gt;So there it is, a powerful and flexible build system implemented and configured from just Rust code. I haven’t bothered to release it as a crate at all - if someone asks me to I might but I don’t know if it would be useful to anyone else, or if something like this already exists in the ecosystem. But I’m sharing it because I think it’s quite a neat solution to this particular problem.&lt;/p&gt;&lt;h2 id=&apos;the-markdown-renderer&apos;&gt;&lt;a href=&apos;#the-markdown-renderer&apos; class=&apos;anchor&apos;&gt;&lt;/a&gt;The Markdown renderer&lt;/h2&gt;&lt;p&gt;The heart of this ad-hoc site generator is really the Markdown renderer. It’s what converts the Markdown files that I write the posts in into the HTML being rendered right now by your web browser. So it’s fitting for us to start there.&lt;/p&gt;&lt;p&gt;A markdown renderer consists of two main parts: the first stage that parses the source strings into a more code-friendly format, and the second stage that generates the HTML from the abstract Rust representation produced by the parser.&lt;/p&gt;&lt;p&gt;I don’t enjoy writing parsers, so I decided to shell out to an external crate for that. I chose &lt;a href=&apos;https://docs.rs/pulldown_cmark&apos;&gt;&lt;code class=&apos;scode&apos;&gt;pulldown_cmark&lt;/code&gt;&lt;/a&gt; because it is widely used, has a flexible API and supports a bunch of features that I really like (CommonMark + tables + smart quotes + heading IDs).&lt;/p&gt;&lt;p&gt;While &lt;code class=&apos;scode&apos;&gt;pulldown_cmark&lt;/code&gt; does come with its own HTML generator and I could’ve just used that and called it a day, there are a bunch of features and additions I would like to implement that would be far easier if I could control generation myself rather than trying to modify the HTML AST after-the-fact.&lt;/p&gt;&lt;p&gt;So, taking inspiration from &lt;code class=&apos;scode&apos;&gt;pulldown_cmark&lt;/code&gt;’s HTML renderer, I resolved to write my own. It works by walking once through all the events emitted by &lt;code class=&apos;scode&apos;&gt;pulldown_cmark&lt;/code&gt;’s &lt;code class=&apos;scode&apos;&gt;Parser&lt;/code&gt; struct and keeping track of state along the way in a gigantic &lt;code class=&apos;scode&apos;&gt;Renderer&lt;/code&gt; type. Once the tree walk is finished, it runs a bit of finalization before dumping its relevant fields in the resulting &lt;code class=&apos;scode&apos;&gt;Markdown&lt;/code&gt; struct:&lt;/p&gt;&lt;pre class=&apos;scode&apos;&gt;&lt;code&gt;&lt;span class=&quot;ssource srust&quot;&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;sstorage stype sstruct srust&quot;&gt;struct&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;sentity sname sstruct srust&quot;&gt;Markdown&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sstruct srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;svariable sother smember srust&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; String,
    &lt;span class=&quot;svariable sother smember srust&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; String,
    &lt;span class=&quot;svariable sother smember srust&quot;&gt;summary&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; String,
    &lt;span class=&quot;svariable sother smember srust&quot;&gt;outline&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;:&lt;/span&gt; String,
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Looking at these fields, you can probably tell why I didn’t just use the default HTML generator - there’s a lot of custom functionality in there not provided by plain &lt;code class=&apos;scode&apos;&gt;pulldown_cmark&lt;/code&gt;. &lt;code class=&apos;scode&apos;&gt;title&lt;/code&gt; contains the title of the page, &lt;code class=&apos;scode&apos;&gt;body&lt;/code&gt; contains the body HTML (but excluding the title), &lt;code class=&apos;scode&apos;&gt;summary&lt;/code&gt; contains the un-HTML-ified first paragraph of the content (this is used to put in each page’s &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;stext shtml sbasic&quot;&gt; &lt;span class=&quot;smeta stag sinline sany shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stag sbegin shtml&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sentity sname stag sinline sany shtml&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sentity sother sattribute-name shtml&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator skey-value shtml&quot;&gt;=&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sstring squoted sdouble shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin shtml&quot;&gt;&amp;quot;&lt;/span&gt;description&lt;span class=&quot;spunctuation sdefinition sstring send shtml&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition stag send shtml&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; tags) and &lt;code class=&apos;scode&apos;&gt;outline&lt;/code&gt; is the automatically generated table of contents you can see at the top of this page.&lt;/p&gt;&lt;p&gt;Another reason I wanted to write my own HTML renderer is to enable syntax highlighting - by default &lt;code class=&apos;scode&apos;&gt;pulldown_cmark&lt;/code&gt; puts all code into plain &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;stext shtml sbasic&quot;&gt; &lt;span class=&quot;smeta stag sblock sany shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stag sbegin shtml&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sentity sname stag sblock sany shtml&quot;&gt;pre&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition stag send shtml&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; and &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;stext shtml sbasic&quot;&gt; &lt;span class=&quot;smeta stag sinline sany shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stag sbegin shtml&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sentity sname stag sinline sany shtml&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition stag send shtml&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; elements, but I wanted to transform it with build-time syntax highlighting instead to enable the pretty colours you can see in the code I write.&lt;/p&gt;&lt;p&gt;I chose the &lt;a href=&apos;https://github.com/trishume/syntect&apos;&gt;&lt;code class=&apos;scode&apos;&gt;syntect&lt;/code&gt;&lt;/a&gt; crate to do the highlighting, since it’s widely used and has the features I need. It turned out to be pretty simple to add this functionality; I just embed the syntax definitions in the source code and load it in a lazy static, then use a &lt;a href=&apos;https://docs.rs/syntect/4/syntect/html/struct.ClassedHTMLGenerator.html&apos;&gt;&lt;code class=&apos;scode&apos;&gt;ClassedHTMLGenerator&lt;/code&gt;&lt;/a&gt; to produce the actual HTML. The themes can be loaded separately by loading them at runtime in an &lt;code class=&apos;scode&apos;&gt;Asset&lt;/code&gt;, converting them to CSS then concatenating with the CSS file for blog posts.&lt;/p&gt;&lt;p&gt;And that’s pretty much all there is to it: a single pure function that goes from markdown source to rendered HTML, to be later inserted into whichever document needs it. Actually, speaking of inserting it into documents, how &lt;em&gt;does&lt;/em&gt; that work?&lt;/p&gt;&lt;h2 id=&apos;templating&apos;&gt;&lt;a href=&apos;#templating&apos; class=&apos;anchor&apos;&gt;&lt;/a&gt;Templating&lt;/h2&gt;&lt;p&gt;Unfortunately it’s not enough to just take rendered HTML, stick it in a &lt;code class=&apos;scode&apos;&gt;.html&lt;/code&gt; file and call it a day. I need to add an HTML skeleton around it to add the document title, &lt;a href=&apos;#adding-the-favicon&apos;&gt;favicon&lt;/a&gt;, metadata and sitewide navigation links you can see on this page.&lt;/p&gt;&lt;p&gt;Initially, I had written &lt;a href=&apos;https://github.com/SabrinaJewson/sabrinajewson.github.io/blob/2df2918523de279720a5854b658864c92fe0671a/builder/src/util/template.rs&apos;&gt;my own custom templater&lt;/a&gt; for this. It was barely even a templater really, being so ridiculously minimal: just ~100 lines of code that replaced &lt;code class=&apos;scode&apos;&gt;\{variable_name}&lt;/code&gt; with its contents. But as the project continued to grow I realized that I needed a better solution than that, so I decided to switch to a full-fledged templating library.&lt;/p&gt;&lt;p&gt;I chose &lt;a href=&apos;https://docs.rs/handlebars&apos;&gt;&lt;code class=&apos;scode&apos;&gt;handlebars&lt;/code&gt;&lt;/a&gt; for this, not for any particular reason, but I wanted to try it out since I’ve only used Tera before. I used my &lt;code class=&apos;scode&apos;&gt;Asset&lt;/code&gt; system to create an asset that loads all the common “fragment” templates from an &lt;code class=&apos;scode&apos;&gt;include/&lt;/code&gt; directory as well as individual &lt;code class=&apos;scode&apos;&gt;Asset&lt;/code&gt;s for each template per page, then I combined them together and rendered it all to produce the final pages.&lt;/p&gt;&lt;p&gt;The template system turned out to be pretty powerful and definitely worth the extra dependency. I’m able to automatically generate pretty much everything automatically, like my &lt;a href=&apos;.&apos;&gt;list of blog posts&lt;/a&gt; whose content is sourced from the Markdown files only. Additionally, all the HTML boilerplate used repeatedly in every page can be abstracted to &lt;a href=&apos;https://github.com/SabrinaJewson/sabrinajewson.github.io/blob/fa55487a0d9bd3ee46d68fa51ea32d9a2eaa2772/template/include/base.hbs&apos;&gt;a common file&lt;/a&gt; which turned out to be very useful for code reuse.&lt;/p&gt;&lt;h2 id=&apos;minification&apos;&gt;&lt;a href=&apos;#minification&apos; class=&apos;anchor&apos;&gt;&lt;/a&gt;Minification&lt;/h2&gt;&lt;p&gt;To reduce page load times, I decided to minify all my HTML and CSS before writing each asset to its final file. I know that there exist minifiers for this in native Rust, but realistically all the state-of-the-art ones are in JavaScript. I ended up choosing &lt;a href=&apos;https://github.com/terser/html-minifier-terser&apos;&gt;html-minifier-terser&lt;/a&gt; and &lt;a href=&apos;https://clean-css.github.io/&apos;&gt;clean-css&lt;/a&gt; for this, which both seem to be well-maintained and have small output sizes.&lt;/p&gt;&lt;p&gt;Initially I planned on achieving maximum efficiency by using both projects as a library and starting up a single long-running Node process that I communicate with via IPC, to avoid the inefficiencies of starting up a whole new Node instance each time I wanted to minify something. But that plan ended up falling apart rather quickly, since I totally lack experience with Node and just couldn’t figure out how to get it to work. Maybe it’s just me but Node’s &lt;a href=&apos;https://nodejs.org/api/stream.html#readable-streams&apos;&gt;readable stream&lt;/a&gt; interface seems a million times more complicated and hard to use than Rust’s &lt;code class=&apos;scode&apos;&gt;AsyncRead&lt;/code&gt; - it has four (!) separate ways of using the API of which none are as simple as just &lt;code class=&apos;scode&apos;&gt;read_exact&lt;/code&gt;. And it doesn’t help that I despise writing JavaScript altogether - TypeScript makes it somewhat better but in comparison to Rust it’s just painful.&lt;/p&gt;&lt;p&gt;So with that plan scrapped, it was just a matter of calling into their CLIs each time (which luckily both libraries have). To avoid global dependencies I created a local npm package that uses both packages as a dependency. Then I could simply have a &lt;code class=&apos;scode&apos;&gt;std::process::Command&lt;/code&gt; run &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;ssource sshell sbash&quot;&gt; &lt;span class=&quot;smeta sfunction-call sshell&quot;&gt;&lt;span class=&quot;svariable sfunction sshell&quot;&gt;npx&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction-call sarguments sshell&quot;&gt; html-minifier-terser&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; or &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;ssource sshell sbash&quot;&gt; &lt;span class=&quot;smeta sfunction-call sshell&quot;&gt;&lt;span class=&quot;svariable sfunction sshell&quot;&gt;npx&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction-call sarguments sshell&quot;&gt; cleancss&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; in that package’s directory and pipe through my files to have them minified.&lt;/p&gt;&lt;p&gt;The one issue I encountered is that unlike Cargo, npm doesn’t automatically install required dependencies before trying to run code. This means that in order to successfully build my website from a freshly cloned repository, you would’ve had to manually &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;ssource sshell sbash&quot;&gt; &lt;span class=&quot;smeta sfunction-call sshell&quot;&gt;&lt;span class=&quot;ssupport sfunction scd sshell&quot;&gt;cd&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; to the package directory and run &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;ssource sshell sbash&quot;&gt; &lt;span class=&quot;smeta sfunction-call sshell&quot;&gt;&lt;span class=&quot;svariable sfunction sshell&quot;&gt;npm&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction-call sarguments sshell&quot;&gt; install&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; beforehand - obviously not ideal.&lt;/p&gt;&lt;p&gt;My first solution to this was just to run that command first thing whenever the building binary starts up. But since &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;ssource sshell sbash&quot;&gt; &lt;span class=&quot;smeta sfunction-call sshell&quot;&gt;&lt;span class=&quot;svariable sfunction sshell&quot;&gt;npm&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction-call sarguments sshell&quot;&gt; install&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; is slow, it ends up slowing down the whole building process quite a significant amount since I have to wait for it each time. What I really needed was a way to only run the command when it hasn’t been run yet, or when the &lt;code class=&apos;scode&apos;&gt;package.json&lt;/code&gt; changes. Lucky, my whole &lt;code class=&apos;scode&apos;&gt;Asset&lt;/code&gt; system is just perfect for that - I could simply define an asset that runs &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;ssource sshell sbash&quot;&gt; &lt;span class=&quot;smeta sfunction-call sshell&quot;&gt;&lt;span class=&quot;svariable sfunction sshell&quot;&gt;npm&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction-call sarguments sshell&quot;&gt; install&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; with &lt;code class=&apos;scode&apos;&gt;package.json&lt;/code&gt; specified as its input file and &lt;code class=&apos;scode&apos;&gt;package-lock.json&lt;/code&gt; as the output one (since &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;ssource sshell sbash&quot;&gt; &lt;span class=&quot;smeta sfunction-call sshell&quot;&gt;&lt;span class=&quot;svariable sfunction sshell&quot;&gt;npm&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction-call sarguments sshell&quot;&gt; install&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; always updates its modification date). It ended up just being a couple lines of code:&lt;/p&gt;&lt;pre class=&apos;scode&apos;&gt;&lt;code&gt;&lt;span class=&quot;ssource srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;sstorage stype sfunction srust&quot;&gt;fn&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;sentity sname sfunction srust&quot;&gt;asset&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt; &lt;span class=&quot;smeta sfunction sreturn-type srust&quot;&gt;&lt;span class=&quot;spunctuation sseparator srust&quot;&gt;-&amp;gt;&lt;/span&gt; impl &lt;span class=&quot;smeta sgeneric srust&quot;&gt;Asset&lt;span class=&quot;spunctuation sdefinition sgeneric sbegin srust&quot;&gt;&amp;lt;&lt;/span&gt;Output = &lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition sgeneric send srust&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction srust&quot;&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock sbegin srust&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;smeta spath srust&quot;&gt;asset&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta spath srust&quot;&gt;FsPath&lt;span class=&quot;spunctuation saccessor srust&quot;&gt;::&lt;/span&gt;&lt;/span&gt;new&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sstring squoted sdouble srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin srust&quot;&gt;&amp;quot;&lt;/span&gt;./builder/js/package.json&lt;span class=&quot;spunctuation sdefinition sstring send srust&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
        .&lt;span class=&quot;ssupport sfunction srust&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sparameters sbegin srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;smeta sfunction sparameters srust&quot;&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sparameters send srust&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;smeta sfunction sclosure srust&quot;&gt;&lt;span class=&quot;ssupport sfunction srust&quot;&gt;log_errors&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ssupport sfunction srust&quot;&gt;npm_install&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
        .&lt;span class=&quot;ssupport sfunction srust&quot;&gt;modifies_path&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin srust&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sstring squoted sdouble srust&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin srust&quot;&gt;&amp;quot;&lt;/span&gt;./builder/js/package-lock.json&lt;span class=&quot;spunctuation sdefinition sstring send srust&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup send srust&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;smeta sblock srust&quot;&gt;&lt;span class=&quot;spunctuation ssection sblock send srust&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And now I have the best of both worlds: fast building as well as automatic package setup.&lt;/p&gt;&lt;h2 id=&apos;adding-a-dark-theme&apos;&gt;&lt;a href=&apos;#adding-a-dark-theme&apos; class=&apos;anchor&apos;&gt;&lt;/a&gt;Adding a dark theme&lt;/h2&gt;&lt;p&gt;One specific goal I had for this site was to allow it to work in both light and dark modes, depending on the user’s chosen &lt;code class=&apos;scode&apos;&gt;prefers-color-scheme&lt;/code&gt; setting. I was mildly dreading having to write out two large stylesheets with a different colour palette for each mode, but as it turns out modern browsers have a built-in way to change the default color scheme based on the user’s current &lt;code class=&apos;scode&apos;&gt;prefers-color-scheme&lt;/code&gt; value. All I had to do was add one &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;stext shtml sbasic&quot;&gt; &lt;span class=&quot;smeta stag sinline sany shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stag sbegin shtml&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sentity sname stag sinline sany shtml&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition stag send shtml&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; to my &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;stext shtml sbasic&quot;&gt; &lt;span class=&quot;smeta stag sstructure sany shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stag sbegin shtml&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sentity sname stag sstructure sany shtml&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition stag send shtml&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;:&lt;/p&gt;&lt;pre class=&apos;scode&apos;&gt;&lt;code&gt;&lt;span class=&quot;stext shtml sbasic&quot;&gt;&lt;span class=&quot;smeta stag sinline sany shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stag sbegin shtml&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sentity sname stag sinline sany shtml&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sentity sother sattribute-name shtml&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator skey-value shtml&quot;&gt;=&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sstring squoted sdouble shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin shtml&quot;&gt;&amp;quot;&lt;/span&gt;color-scheme&lt;span class=&quot;spunctuation sdefinition sstring send shtml&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sentity sother sattribute-name shtml&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator skey-value shtml&quot;&gt;=&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sstring squoted sdouble shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin shtml&quot;&gt;&amp;quot;&lt;/span&gt;dark light&lt;span class=&quot;spunctuation sdefinition sstring send shtml&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition stag send shtml&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And everything magically worked first try - if &lt;code class=&apos;scode&apos;&gt;prefers-color-scheme&lt;/code&gt; was &lt;code class=&apos;scode&apos;&gt;dark&lt;/code&gt;, the page would show a black background with consistently white text and if it was &lt;code class=&apos;scode&apos;&gt;light&lt;/code&gt; it would show a white background with consistently black text. You can try it out now - if you open developer tools and press ctrl+shift+p, you should be able to enable the “emulate CSS prefers-color-scheme: dark/light” option and see how the website changes. And all that’s done entirely by the browser’s default styles. Who knew it was so easy?&lt;/p&gt;&lt;p&gt;The only time I did have to mess with &lt;code class=&apos;scode&apos;&gt;prefers-color-scheme&lt;/code&gt; media queries was for the code blocks. That was easy though, I just wrote out the dark theme CSS then wrapped the light version in &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;ssource scss&quot;&gt;&lt;span class=&quot;smeta sat-rule smedia scss&quot;&gt; &lt;span class=&quot;skeyword scontrol sat-rule smedia scss&quot;&gt;&lt;span class=&quot;spunctuation sdefinition skeyword scss&quot;&gt;@&lt;/span&gt;media&lt;/span&gt; &lt;span class=&quot;spunctuation sdefinition sgroup sbegin scss&quot;&gt;(&lt;/span&gt;prefers-&lt;span class=&quot;ssupport stype sproperty-name smedia scss&quot;&gt;color&lt;/span&gt;-scheme&lt;span class=&quot;spunctuation sseparator skey-value scss&quot;&gt;:&lt;/span&gt; light&lt;span class=&quot;spunctuation sdefinition sgroup send scss&quot;&gt;)&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;spunctuation ssection sproperty-list scss&quot;&gt;{&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;&lt;h2 id=&apos;adding-the-favicon&apos;&gt;&lt;a href=&apos;#adding-the-favicon&apos; class=&apos;anchor&apos;&gt;&lt;/a&gt;Adding the favicon&lt;/h2&gt;&lt;p&gt;The favicon of this site is automatically generated by the build script from a single &lt;code class=&apos;scode&apos;&gt;.png&lt;/code&gt; file in source control. I use the &lt;a href=&apos;https://docs.rs/image&apos;&gt;&lt;code class=&apos;scode&apos;&gt;image&lt;/code&gt;&lt;/a&gt; crate to read in this source image, then resize it to generate two files:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code class=&apos;scode&apos;&gt;favicon.ico&lt;/code&gt;, which contains 16x16, 32x32 and 64x64 versions of the icon all packed into a single &lt;code class=&apos;scode&apos;&gt;.ico&lt;/code&gt; file.&lt;/li&gt;&lt;li&gt;&lt;code class=&apos;scode&apos;&gt;apple-touch-icon.png&lt;/code&gt;, which has been resized to 180x180 as is suitable for an apple touch icon.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;The paths of these files are then passed in to the templates, which include them in &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;stext shtml sbasic&quot;&gt; &lt;span class=&quot;smeta stag sinline sany shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stag sbegin shtml&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sentity sname stag sinline sany shtml&quot;&gt;link&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition stag send shtml&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; tags in the head:&lt;/p&gt;&lt;pre class=&apos;scode&apos;&gt;&lt;code&gt;&lt;span class=&quot;stext shtml sbasic&quot;&gt;&lt;span class=&quot;smeta stag sinline sany shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stag sbegin shtml&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sentity sname stag sinline sany shtml&quot;&gt;link&lt;/span&gt; &lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sentity sother sattribute-name shtml&quot;&gt;rel&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator skey-value shtml&quot;&gt;=&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sstring squoted sdouble shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin shtml&quot;&gt;&amp;quot;&lt;/span&gt;icon&lt;span class=&quot;spunctuation sdefinition sstring send shtml&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sentity sother sattribute-name shtml&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator skey-value shtml&quot;&gt;=&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sstring squoted sdouble shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin shtml&quot;&gt;&amp;quot;&lt;/span&gt;/{{icons.favicon}}&lt;span class=&quot;spunctuation sdefinition sstring send shtml&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition stag send shtml&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;smeta stag sinline sany shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stag sbegin shtml&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sentity sname stag sinline sany shtml&quot;&gt;link&lt;/span&gt; &lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sentity sother sattribute-name shtml&quot;&gt;rel&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator skey-value shtml&quot;&gt;=&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sstring squoted sdouble shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin shtml&quot;&gt;&amp;quot;&lt;/span&gt;apple-touch-icon&lt;span class=&quot;spunctuation sdefinition sstring send shtml&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sentity sother sattribute-name shtml&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator skey-value shtml&quot;&gt;=&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sattribute-with-value shtml&quot;&gt;&lt;span class=&quot;sstring squoted sdouble shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin shtml&quot;&gt;&amp;quot;&lt;/span&gt;/{{icons.apple_touch_icon}}&lt;span class=&quot;spunctuation sdefinition sstring send shtml&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition stag send shtml&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I’m especially proud of this part of the code because the entire thing is implemented in &amp;lt;100 lines of logic and is far, far more convenient than manually using a site like &lt;a href=&apos;https://realfavicongenerator.net/&apos;&gt;RealFaviconGenerator&lt;/a&gt; to generate each of the files. The only downside of it is that &lt;a href=&apos;https://docs.rs/image&apos;&gt;&lt;code class=&apos;scode&apos;&gt;image&lt;/code&gt;&lt;/a&gt; is ridiculously slow in debug mode, so I end up running the build process in &lt;code class=&apos;scode&apos;&gt;--release&lt;/code&gt; all the time 😄.&lt;/p&gt;&lt;h2 id=&apos;a-live-reloading-dev-server&apos;&gt;&lt;a href=&apos;#a-live-reloading-dev-server&apos; class=&apos;anchor&apos;&gt;&lt;/a&gt;A live-reloading dev server&lt;/h2&gt;&lt;p&gt;For a long time I was previewing the website by just opening the file in the browser as a &lt;code class=&apos;scode&apos;&gt;file://&lt;/code&gt; URL. But this had several disadvantages:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Paths like &lt;code class=&apos;scode&apos;&gt;/favicon.ico&lt;/code&gt; would be resolved relative to the filesystem root, rather than the website root.&lt;/li&gt;&lt;li&gt;&lt;code class=&apos;scode&apos;&gt;index.html&lt;/code&gt; wasn’t automatically added to the end of paths if they pointed to directories and that file existed. I’d instead see a screen showing a file listing of the directory and have to click &lt;code class=&apos;scode&apos;&gt;index.html&lt;/code&gt; manually each time.&lt;/li&gt;&lt;li&gt;&lt;code class=&apos;scode&apos;&gt;.html&lt;/code&gt; wasn’t automatically added to the end of paths like &lt;code class=&apos;scode&apos;&gt;/blog/foo&lt;/code&gt;, making my links broken.&lt;/li&gt;&lt;li&gt;404 links did not show my custom &lt;code class=&apos;scode&apos;&gt;404.html&lt;/code&gt; page.&lt;/li&gt;&lt;li&gt;I didn’t get live reloading.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;At some point I switched to &lt;code class=&apos;scode&apos;&gt;&lt;span class=&quot;ssource sshell sbash&quot;&gt; &lt;span class=&quot;smeta sfunction-call sshell&quot;&gt;&lt;span class=&quot;svariable sfunction sshell&quot;&gt;python&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sfunction-call sarguments sshell&quot;&gt;&lt;span class=&quot;svariable sparameter soption sshell&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sparameter sshell&quot;&gt; -&lt;/span&gt;m&lt;/span&gt; http.server&lt;/span&gt;&lt;/span&gt;&lt;/code&gt; and that solved issues (1) and (2) but not the others. So eventually I’d had enough and decided to write my own server with all these features, in Rust.&lt;/p&gt;&lt;p&gt;Since the server doesn’t need to be particularly complex, I decided to just use plain &lt;a href=&apos;https://docs.rs/hyper&apos;&gt;hyper&lt;/a&gt; - no higher-level framework or anything. And it doesn’t need performance, so I’m only using Tokio’s current thread runtime instead of the heavier multi-threaded scheduler.&lt;/p&gt;&lt;p&gt;The server’s main job is to take a request path and map it to a path on the filesystem, which it does just by splitting on &lt;code class=&apos;scode&apos;&gt;/&lt;/code&gt; and reconstructing a &lt;code class=&apos;scode&apos;&gt;PathBuf&lt;/code&gt;. I also have some extra logic to solve problems (2) and (3) - adding &lt;code class=&apos;scode&apos;&gt;index.html&lt;/code&gt; and &lt;code class=&apos;scode&apos;&gt;.html&lt;/code&gt; to paths as a fallback if the requested path doesn’t exist. I guess the MIME type to serve based on file extension, which works fine for me, and also set &lt;code class=&apos;scode&apos;&gt;Cache-Control: no-cache&lt;/code&gt; to avoid having the browser cache the pages.&lt;/p&gt;&lt;p&gt;To achieve live reloading, two things need to be coordinated. First, the server has to expose an endpoint that allows the browser to wait for a change to happen to any of the files it’s viewing - I do this via a &lt;code class=&apos;scode&apos;&gt;/watch&lt;/code&gt; endpoint that accepts a list of paths to watch in its query parameters (decoded with &lt;a href=&apos;https://docs.rs/form_urlencoded&apos;&gt;&lt;code class=&apos;scode&apos;&gt;form_urlencoded&lt;/code&gt;&lt;/a&gt;) and gives back an SSE stream that sends an empty event once something happens. Internally this is implemented with a Tokio &lt;code class=&apos;scode&apos;&gt;broadcast&lt;/code&gt; channel of &lt;code class=&apos;scode&apos;&gt;notify::Event&lt;/code&gt;s, and a spawned task that subscribes to the channel and checks whether any of the events apply to it, sending an SSE event if so. Secondly, the client needs to produce a list of all the files it depends on and then send that in the SSE request to the server, reloading once it receives any data over that connection.&lt;/p&gt;&lt;p&gt;I do all that by passing in a boolean property &lt;code class=&apos;scode&apos;&gt;live_reload&lt;/code&gt; to the templates, and only enable it when the server is running (this is easy since the server and build process share the same binary). The page will build up a set of dependencies in a &lt;code class=&apos;scode&apos;&gt;URLSearchParams&lt;/code&gt; object then send off the request like so:&lt;/p&gt;&lt;pre class=&apos;scode&apos;&gt;&lt;code&gt;&lt;span class=&quot;stext shtml sbasic&quot;&gt;{{#if live_reload}}
&lt;span class=&quot;smeta stag sscript sbegin shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stag sbegin shtml&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;sentity sname stag sscript shtml&quot;&gt;script&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta stag sscript sbegin shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stag send shtml&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;ssource sjs sembedded shtml&quot;&gt;&lt;span class=&quot;ssource sjs&quot;&gt;	&lt;span class=&quot;sstorage stype sjs&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;svariable sother sreadwrite sjs&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;skeyword soperator sassignment sjs&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;smeta sinstance sconstructor sjs&quot;&gt;&lt;span class=&quot;skeyword soperator sword snew sjs&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;smeta sfunction-call sconstructor sjs&quot;&gt; &lt;span class=&quot;svariable stype sjs&quot;&gt;EventSource&lt;/span&gt;&lt;span class=&quot;smeta sgroup sjs&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sjs&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sstring stemplate sjs&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring stemplate sbegin sjs&quot;&gt;`&lt;/span&gt;/watch?&lt;/span&gt;&lt;span class=&quot;smeta stemplate sexpression sjs&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stemplate-expression sbegin sjs&quot;&gt;${&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta stemplate sexpression sjs&quot;&gt;&lt;span class=&quot;ssource sjs sembedded sexpression&quot;&gt;&lt;span class=&quot;svariable sother sreadwrite sjs&quot;&gt;params&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition stemplate-expression send sjs&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;sstring stemplate sjs&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring stemplate send sjs&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup sjs&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sjs&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator sstatement sjs&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;svariable sother sobject sjs&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;spunctuation saccessor sjs&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;smeta sfunction-call smethod sjs&quot;&gt;&lt;span class=&quot;svariable sfunction sjs&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;smeta sgroup sjs&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sjs&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sstring squoted sdouble sjs&quot;&gt;&lt;span class=&quot;spunctuation sdefinition sstring sbegin sjs&quot;&gt;&amp;quot;&lt;/span&gt;message&lt;span class=&quot;spunctuation sdefinition sstring send sjs&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sseparator scomma sjs&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;smeta sfunction sdeclaration sjs&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sbegin sjs&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;spunctuation ssection sgroup send sjs&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;smeta sfunction sdeclaration sjs&quot;&gt; &lt;/span&gt;&lt;span class=&quot;sstorage stype sfunction sarrow sjs&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;smeta sblock sjs&quot;&gt;&lt;span class=&quot;svariable sother sobject sjs&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;spunctuation saccessor sjs&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;smeta sfunction-call smethod sjs&quot;&gt;&lt;span class=&quot;svariable sfunction sjs&quot;&gt;reload&lt;/span&gt;&lt;span class=&quot;smeta sgroup sjs&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sjs&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup sjs&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sjs&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta sgroup sjs&quot;&gt;&lt;span class=&quot;spunctuation ssection sgroup sjs&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;spunctuation sterminator sstatement sjs&quot;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;smeta stag sscript send shtml&quot;&gt;&lt;span class=&quot;spunctuation sdefinition stag sbegin shtml&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;sentity sname stag sscript shtml&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;spunctuation sdefinition stag send shtml&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
{{/if}}
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;And just like that, we have live reloading. Whenever I edit one of the source files like the one I’m writing, a whole chain of automated events is set off, culminating in the reload of the page I’m viewing in-browser:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;The &lt;code class=&apos;scode&apos;&gt;notify&lt;/code&gt; watcher sees the event and regenerates the main asset.&lt;/li&gt;&lt;li&gt;The main asset generates the “blog posts” asset.&lt;/li&gt;&lt;li&gt;The “blog posts” asset generates the asset for this blog post.&lt;/li&gt;&lt;li&gt;This asset compares the dates of its input and output files, and upon seeing that the input file is newer than the output file decides to regenerate itself.&lt;/li&gt;&lt;li&gt;The updated blog post HTML is written out to the &lt;code class=&apos;scode&apos;&gt;dist/&lt;/code&gt; directory.&lt;/li&gt;&lt;li&gt;The &lt;code class=&apos;scode&apos;&gt;notify&lt;/code&gt; watcher sees the event and passes it over to the server’s broadcast channel.&lt;/li&gt;&lt;li&gt;The task spawned to manage the connnection to the site receives the event from the channel, and upon checking what paths it affects decides that the web page should reload.&lt;/li&gt;&lt;li&gt;The task sends an SSE event to the website which it then receives.&lt;/li&gt;&lt;li&gt;The website reloads, sending a new request to the server and receiving the updated blog post HTML.&lt;/li&gt;&lt;/ol&gt;&lt;h2 id=&apos;conclusion&apos;&gt;&lt;a href=&apos;#conclusion&apos; class=&apos;anchor&apos;&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;&lt;p&gt;Overall, I am extremely pleased with how this whole project has turned out. I now have my own personal website, designed in exactly the way I like it able to support exactly the workflow that I like, with almost everything completely automated with the power of code.&lt;/p&gt;&lt;p&gt;Do I recommend it if you want to start your own website? Not really, unless you’d do this sort of programming project anyway. All in all it took about a week to set up, and I was working on it for several hours each day. I can probably imagine that using an existing static site generator is a thousand times easier and faster and produces just as good output. But it was an extremely fun project for me do so I can definitely recommend it in that sense.&lt;/p&gt;&lt;p&gt;If you want to check out the actual code it’s &lt;a href=&apos;https://github.com/SabrinaJewson/sabrinajewson.github.io&apos;&gt;on GitHub&lt;/a&gt; and contains all the things I talked about here, as well as some more mundane stuff I left out the article for brevity. Its file structure is located into three main folders:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code class=&apos;scode&apos;&gt;builder&lt;/code&gt;, which contains the Rust source code of the crate that builds the site and runs the server.&lt;/li&gt;&lt;li&gt;&lt;code class=&apos;scode&apos;&gt;template&lt;/code&gt;, which contains Handlebars templates, CSS, code themes and various other dynamic configuration parts related to the site.&lt;/li&gt;&lt;li&gt;&lt;code class=&apos;scode&apos;&gt;src&lt;/code&gt;, which contains the source Markdown of the posts I’ve written as well as the favicon of the website.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Anyway, I really hope you enjoyed reading this post and maybe learnt something you found interesting. See you next time!&lt;/p&gt;</content></entry></feed>